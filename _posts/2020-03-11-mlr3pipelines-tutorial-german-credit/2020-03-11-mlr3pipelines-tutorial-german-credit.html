<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
  <title>mlr3pipelines tutorial - german credit</title>

  <meta property="description" itemprop="description" content="In this tutorial we will continue working with the German Credit Dataset. We already used different Learners on it in previous posts and tried to optimize their hyperparameters. To make things interesting, we introduce missing values into the dataset."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2020-03-11"/>
  <meta property="article:created" itemprop="dateCreated" content="2020-03-11"/>
  <meta name="article:author" content="Martin Binder"/>
  <meta name="article:author" content="Florian Pfisterer"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="mlr3pipelines tutorial - german credit"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="In this tutorial we will continue working with the German Credit Dataset. We already used different Learners on it in previous posts and tried to optimize their hyperparameters. To make things interesting, we introduce missing values into the dataset."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="mlr3pipelines tutorial - german credit"/>
  <meta property="twitter:description" content="In this tutorial we will continue working with the German Credit Dataset. We already used different Learners on it in previous posts and tried to optimize their hyperparameters. To make things interesting, we introduce missing values into the dataset."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","categories","author","date","description","output"]}},"value":[{"type":"character","attributes":{},"value":["mlr3pipelines tutorial - german credit"]},{"type":"character","attributes":{},"value":["tuning","imputation","filtering"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Martin Binder"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Florian Pfisterer"]}]}]},{"type":"character","attributes":{},"value":["03-11-2020"]},{"type":"character","attributes":{},"value":["In this tutorial we will continue working with the German Credit Dataset. We already used different Learners on it in previous posts and tried to optimize their hyperparameters. To make things interesting, we introduce missing values into the dataset.\n"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","css"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["../../custom.css"]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["2020-03-11-mlr3pipelines-tutorial-german-credit_files/bowser-1.9.3/bowser.min.js","2020-03-11-mlr3pipelines-tutorial-german-credit_files/distill-2.2.21/template.v2.js","2020-03-11-mlr3pipelines-tutorial-german-credit_files/figure-html5/unnamed-chunk-21-1.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/figure-html5/unnamed-chunk-23-1.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/figure-html5/unnamed-chunk-30-1.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/header-attrs-2.1/header-attrs.js","2020-03-11-mlr3pipelines-tutorial-german-credit_files/htmlwidgets-1.5.1/htmlwidgets.js","2020-03-11-mlr3pipelines-tutorial-german-credit_files/jquery-1.11.3/jquery.min.js","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/acceptDeleteIcon.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/addNodeIcon.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/backIcon.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/connectIcon.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/cross.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/cross2.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/deleteIcon.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/downArrow.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/editIcon.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/leftArrow.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/minus.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/plus.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/rightArrow.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/upArrow.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/img/network/zoomExtends.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/vis.css","2020-03-11-mlr3pipelines-tutorial-german-credit_files/vis-4.20.1/vis.min.js","2020-03-11-mlr3pipelines-tutorial-german-credit_files/visNetwork-binding-2.0.9/visNetwork.js","2020-03-11-mlr3pipelines-tutorial-german-credit_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for table of contents */

  .d-toc {
    color: rgba(0,0,0,0.8);
    font-size: 0.8em;
    line-height: 1em;
  }

  .d-toc-header {
    font-size: 0.6rem;
    font-weight: 400;
    color: rgba(0, 0, 0, 0.5);
    text-transform: uppercase;
    margin-top: 0;
    margin-bottom: 1.3em;
  }

  .d-toc a {
    border-bottom: none;
  }

  .d-toc ul {
    padding-left: 0;
  }

  .d-toc li>ul {
    padding-top: 0.8em;
    padding-left: 16px;
    margin-bottom: 0.6em;
  }

  .d-toc ul,
  .d-toc li {
    list-style-type: none;
  }

  .d-toc li {
    margin-bottom: 0.9em;
  }

  .d-toc-separator {
    margin-top: 20px;
    margin-bottom: 2em;
  }

  .d-article-with-toc {
    border-top: none;
    padding-top: 0;
  }



  /* Tweak code blocks (note that this CSS is repeated above in an injection
     into the d-code shadow dom) */

  d-code {
    overflow-x: auto !important;
  }

  pre.d-code code.d-code {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  pre.text-output {

    font-size: 12px;
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  @media(min-width: 768px) {

  d-code {
    overflow-x: visible !important;
  }

  pre.d-code code.d-code  {
      padding-left: 18px;
      font-size: 14px;
  }
  pre.text-output {
    font-size: 14px;
  }
  }

  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }



  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }


  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // create d-bibliography
    var bibliography = $('<d-bibliography></d-bibliography>');
    $('#distill-bibliography').wrap(bibliography);

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace citations with <d-cite>
    $('.citation').each(function(i, val) {
      appendix = true;
      var cites = $(this).attr('data-cites').split(" ");
      var dt_cite = $('<d-cite></d-cite>');
      dt_cite.attr('key', cites.join());
      $(this).replaceWith(dt_cite);
    });
    // remove refs
    $('#refs').remove();

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-toc a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // replace code blocks with d-code
    $('pre>code').each(function(i, val) {
      var code = $(this);
      var pre = code.parent();
      var clz = "";
      var language = pre.attr('class');
      if (language) {
        // map unknown languages to "clike" (without this they just dissapear)
        if ($.inArray(language, ["bash", "clike", "css", "go", "html",
                                 "javascript", "js", "julia", "lua", "markdown",
                                 "markup", "mathml", "python", "svg", "xml"]) == -1)
          language = "clike";
        language = ' language="' + language + '"';
        var dt_code = $('<d-code block' + language + clz + '></d-code>');
        dt_code.text(code.text());
        pre.replaceWith(dt_code);
      } else {
        code.addClass('text-output').unwrap().changeElementType('pre');
      }
    });

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('d-code, pre.text-output, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // table of contents
      if (have_authors) // adjust border if we are in authors
        $('.d-toc').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // inject pre code styles (can't do this with a global stylesheet b/c a shadow root is used)
      $('d-code').each(function(i, val) {
        var style = document.createElement('style');
        style.innerHTML = 'pre code { padding-left: 10px; font-size: 12px; border-left: 2px solid rgba(0,0,0,0.1); } ' +
                          '@media(min-width: 768px) { pre code { padding-left: 18px; font-size: 14px; } }';
        if (this.shadowRoot)
          this.shadowRoot.appendChild(style);
      });

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-toc-header').remove();
    $('.d-toc').remove();
    $('.d-toc-separator').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="2020-03-11-mlr3pipelines-tutorial-german-credit_files/header-attrs-2.1/header-attrs.js"></script>
  <script src="2020-03-11-mlr3pipelines-tutorial-german-credit_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="2020-03-11-mlr3pipelines-tutorial-german-credit_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="2020-03-11-mlr3pipelines-tutorial-german-credit_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="2020-03-11-mlr3pipelines-tutorial-german-credit_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="../../custom.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"mlr3pipelines tutorial - german credit","description":"In this tutorial we will continue working with the German Credit Dataset. We already used different Learners on it in previous posts and tried to optimize their hyperparameters. To make things interesting, we introduce missing values into the dataset.","authors":[{"author":"Martin Binder","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#"},{"author":"Florian Pfisterer","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#"}],"publishedDate":"2020-03-11T00:00:00.000+01:00","citationText":"Binder & Pfisterer, 2020"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>mlr3pipelines tutorial - german credit</h1>
<p><p>In this tutorial we will continue working with the German Credit Dataset. We already used different Learners on it in previous posts and tried to optimize their hyperparameters. To make things interesting, we introduce missing values into the dataset.</p></p>
</div>

<div class="d-byline">
  Martin Binder  
  
,   Florian Pfisterer  
  
<br/>03-11-2020
</div>

<div class="d-article">
<h2 id="intro">Intro</h2>
<p>This is the third part in a serial of tutorials. The other parts of this series can be found here:</p>
<ul>
<li><a href="/basics_german_credit/">Part I - Basics</a></li>
<li><a href="/basics_tuning_german_credit/">Part II - Tuning</a></li>
</ul>
<p>In this tutorial we will continue working with the <strong>German Credit Dataset</strong>. We already used different <code>Learner</code>s on it and tried to optimize their hyperparameters. Now we will</p>
<ul>
<li>preprocess the data as an integrated step of the model fitting process</li>
<li>tune the preprocessing parameters</li>
<li>use multiple <code>Learners</code> in an <em>ensemble</em> model</li>
<li>see some techniques that make <code>Learner</code>s able to tackle challenging datasets that they could not handle otherwise.</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(&quot;data.table&quot;)
library(&quot;mlr3&quot;)
library(&quot;mlr3learners&quot;)
library(&quot;mlr3pipelines&quot;)
library(&quot;mlr3tuning&quot;)
library(&quot;ggplot2&quot;)</code></pre>
</div>
<p>We use the same data as in the mlr3_basics_german_credit example, but will restrict ourselves to the <em>numerical features</em>. To make things interesting, we introduce <em>missing values</em> in the dataset.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
task = tsk(&quot;german_credit&quot;)
credit_full = task$data()
credit = credit_full[, sapply(credit_full, is.numeric), with = FALSE]

set.seed(20191101)
## turn 10% of values into an NA
credit = credit[, lapply(.SD, function(x) {
  x[sample(c(TRUE, NA), length(x), replace = TRUE, prob = c(.9, .1))]
})]
credit$credit_risk = credit_full$credit_risk
task = TaskClassif$new(&quot;GermanCredit&quot;, credit, &quot;credit_risk&quot;)</code></pre>
</div>
<ul>
<li>We instantiate a resampling instance for this task to be able to compare resampling performance.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
set.seed(20191101)
cv10_instance = rsmp(&quot;cv&quot;)$instantiate(task)</code></pre>
</div>
<p>Uncomment the following line if you are running this locally (i.e. not on RStudio Cloud).</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# future::plan(&quot;multiprocess&quot;)</code></pre>
</div>
<h2 id="intro-1">Intro</h2>
<p>In this tutorial we will take a look at composite machine learning algorithms that may incorporate data preprocessing or the combination of multiple <code>Learner</code>s (“ensemble methods”).</p>
<ul>
<li>The package we use is <strong>mlr3pipelines</strong>, which enables us to chain “<code>PipeOp</code>” objects into data flow graphs. Load the package using</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(&quot;mlr3pipelines&quot;)</code></pre>
</div>
<ul>
<li>Available <code>PipeOp</code>s are enumareted in the <code>mlr_pipeops</code> dictionary.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
mlr_pipeops</code></pre>
<pre><code>
&lt;DictionaryPipeOp&gt; with 42 stored values
Keys: boxcox, branch, chunk, classbalancing, classifavg, classweights,
  colapply, collapsefactors, copy, encode, encodeimpact, encodelmer,
  featureunion, filter, fixfactors, histbin, ica, imputehist,
  imputemean, imputemedian, imputenewlvl, imputesample, kernelpca,
  learner, learner_cv, missind, modelmatrix, mutate, nop, pca,
  quantilebin, regravg, removeconstants, scale, scalemaxabs,
  scalerange, select, smote, spatialsign, subsample, unbranch,
  yeojohnson</code></pre>
</div>
<h2 id="missing-value-imputation">Missing Value Imputation</h2>
<ul>
<li>Trying to train a Random Forest fails because the model can not handle missing values.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ranger = lrn(&quot;classif.ranger&quot;)
ranger$train(task)</code></pre>
<pre><code>
Error: Missing data in columns: age, amount, duration, installment_rate, number_credits, people_liable, present_residence.</code></pre>
</div>
<ul>
<li>We can impute using a <code>PipeOp</code>. What are the imputation <code>PipeOp</code>s?</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
mlr_pipeops$keys(&quot;^impute&quot;)</code></pre>
<pre><code>
[1] &quot;imputehist&quot;   &quot;imputemean&quot;   &quot;imputemedian&quot; &quot;imputenewlvl&quot; &quot;imputesample&quot;</code></pre>
</div>
<ul>
<li>We choose to impute numeric features by their median. If we had factorial features, we could also add an imputer for them, e.g. <code>po("imputenewlvl")</code>.</li>
<li>Let’s use the <code>PipeOp</code> itself to create an imputed task. This shows us how the <code>PipeOp</code> works.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
imputer = po(&quot;imputemean&quot;)

task_imputed = imputer$train(list(task))[[1]]

task_imputed$head() # no missing values</code></pre>
<pre><code>
   credit_risk age   amount duration installment_rate number_credits
1:        good  67 1169.000        6          4.00000              2
2:         bad  22 5951.000       48          2.99011              1
3:        good  49 2096.000       12          2.99011              1
4:        good  45 7882.000       42          2.00000              1
5:         bad  53 4870.000       24          3.00000              2
6:        good  35 3285.826       36          2.00000              1
   people_liable present_residence
1:             1                 4
2:             1                 2
3:             2                 3
4:             2                 4
5:             2                 4
6:             2                 4</code></pre>
</div>
<ul>
<li>The <code>$state$model</code> slot contains the medians of all columns. The <code>PipeOp</code> needs to remember these to impute missing values in new data during the <code>$predict()</code> phase.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
imputer$state$model</code></pre>
<pre><code>
$age
[1] 35.66329

$amount
[1] 3285.826

$duration
[1] 20.94919

$installment_rate
[1] 2.99011

$number_credits
[1] 1.406285

$people_liable
[1] 1.153761

$present_residence
[1] 2.854645</code></pre>
</div>
<ul>
<li>If we used the imputed task for resampling, we would leak information from the test set into the training set. Therefore it is mandatory to attach the imputation operator to the <code>Learner</code> itself, creating a <code>GraphLearner</code>.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
imp_ranger = GraphLearner$new(po(&quot;imputemean&quot;) %&gt;&gt;% ranger)

imp_ranger$train(task) # runs without error: training succeeds</code></pre>
</div>
<ul>
<li>This can be used for resampling.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
rr = resample(task, imp_ranger, cv10_instance)
rr$aggregate()</code></pre>
<pre><code>
classif.ce 
     0.297 </code></pre>
</div>
<h2 id="feature-filtering">Feature Filtering</h2>
<ul>
<li>Sometimes having fewer features is desirable (interpretability, cost of acquiring data, possibly even better performance)</li>
<li>Use <em>feature filter</em> to preferentially keep features with most information</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(&quot;mlr3filters&quot;)
mlr_filters</code></pre>
<pre><code>
&lt;DictionaryFilter&gt; with 17 stored values
Keys: anova, auc, carscore, cmim, correlation, disr, find_correlation,
  importance, information_gain, jmi, jmim, kruskal_test, mim, mrmr,
  njmim, performance, variance</code></pre>
</div>
<ul>
<li>We use the <code>"anova"</code> filter. It uses an F-test for values in different target classes (equivalent to a t-test in the binary classification case).</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
filter = flt(&quot;anova&quot;)
filter$calculate(task_imputed)$scores</code></pre>
<pre><code>
         duration            amount               age  installment_rate 
      10.71452277        5.70482677        2.62411784        1.14183395 
   number_credits present_residence     people_liable 
       0.81379060        0.12841352        0.07345883 </code></pre>
</div>
<ul>
<li>What is the tradeoff between features and performance? Let’s find out by tuning.</li>
<li>We incorporate our filtering in the pipeline using the <code>"filter"</code> <code>PipeOp</code></li>
<li>We remember that we also need to do imputation.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
fpipe = po(&quot;imputemean&quot;) %&gt;&gt;% po(&quot;filter&quot;, filter, filter.nfeat = 3)

fpipe$train(task)[[1]]$head()</code></pre>
<pre><code>
   credit_risk age   amount duration
1:        good  67 1169.000        6
2:         bad  22 5951.000       48
3:        good  49 2096.000       12
4:        good  45 7882.000       42
5:         bad  53 4870.000       24
6:        good  35 3285.826       36</code></pre>
</div>
<ul>
<li>We are going to tune over the <code>anova.filter.nfeat</code> parameter; it regulates how many features are kept by the filter.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(&quot;paradox&quot;)
searchspace = ParamSet$new(list(
  ParamInt$new(&quot;anova.filter.nfeat&quot;, lower = 1, upper = length(task$feature_names))
))</code></pre>
</div>
<ul>
<li>Because this is only one parameter, we will use grid search. For higher dimensions, random search is more appropriate.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
inst = TuningInstance$new(
  task, fpipe %&gt;&gt;% lrn(&quot;classif.ranger&quot;), cv10_instance, msr(&quot;classif.ce&quot;),
  searchspace, term(&quot;none&quot;)
)
tuner = tnr(&quot;grid_search&quot;)</code></pre>
</div>
<ul>
<li>Tuning may take a while…</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
tuner$tune(inst)</code></pre>
</div>
<ul>
<li>If we plot the performance over the number of features, we see the possible tradeoffs between sparsity and predictive performance.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
arx = inst$archive(&quot;params&quot;)
ggplot(arx, aes(x = anova.filter.nfeat, y = classif.ce)) + geom_line()</code></pre>
<p><img src="2020-03-11-mlr3pipelines-tutorial-german-credit_files/figure-html5/unnamed-chunk-21-1.png" width="624" /></p>
</div>
<h2 id="stacking">Stacking</h2>
<ul>
<li>We build a model on the predictions of learners</li>
<li>This needs the <code>"learner_cv"</code> PipeOp, because predictions need to be available during training already
<ul>
<li>the <code>"learner_cv"</code> PipeOp performs cross-validation during the training phase and emits the cross validated predictions.</li>
</ul></li>
<li>We use <code>"prob"</code> prediction because it carries more information than response prediction</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
stackgraph = po(&quot;imputemean&quot;) %&gt;&gt;%
  list(
    po(&quot;learner_cv&quot;, lrn(&quot;classif.ranger&quot;, predict_type = &quot;prob&quot;)),
    po(&quot;learner_cv&quot;, lrn(&quot;classif.kknn&quot;, predict_type = &quot;prob&quot;))) %&gt;&gt;%
  po(&quot;featureunion&quot;) %&gt;&gt;% lrn(&quot;classif.log_reg&quot;)</code></pre>
</div>
<ul>
<li>What does this <code>Graph</code> look like? We can plot it!</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
stackgraph$plot()</code></pre>
<p><img src="2020-03-11-mlr3pipelines-tutorial-german-credit_files/figure-html5/unnamed-chunk-23-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
rr = resample(task, stackgraph, cv10_instance, store_model = TRUE)
rr$aggregate()</code></pre>
<pre><code>
classif.ce 
     0.298 </code></pre>
</div>
<ul>
<li>Compare this to performance of individual <code>Learner</code>s. Note, however, that the difference is smaller than the variation in CV estimate.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
bmr = benchmark(data.table(
  task = list(task),
  learner = list(
    GraphLearner$new(po(&quot;imputemean&quot;) %&gt;&gt;% lrn(&quot;classif.ranger&quot;)),
    GraphLearner$new(po(&quot;imputemean&quot;) %&gt;&gt;% lrn(&quot;classif.kknn&quot;)),
    GraphLearner$new(po(&quot;imputemean&quot;) %&gt;&gt;% lrn(&quot;classif.log_reg&quot;))),
  resampling = list(cv10_instance)))
bmr$aggregate()[, c(&quot;learner_id&quot;, &quot;classif.ce&quot;)]</code></pre>
<pre><code>
                   learner_id classif.ce
1:  imputemean.classif.ranger      0.304
2:    imputemean.classif.kknn      0.350
3: imputemean.classif.log_reg      0.291</code></pre>
</div>
<ul>
<li>If we train the stacked <code>Learner</code> and look into the model, we can see how “important” each of the stacked models is</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
stackgraph$train(task)</code></pre>
<pre><code>
$classif.log_reg.output
NULL</code></pre>
<pre class="r"><code>
summary(stackgraph$pipeops$classif.log_reg$state$model)</code></pre>
<pre><code>
Call:
stats::glm(formula = task$formula(), family = &quot;binomial&quot;, data = task$data(), 
    model = FALSE)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.5279  -0.8456  -0.6976   1.2608   1.9124  

Coefficients: (2 not defined because of singularities)
                         Estimate Std. Error z value  Pr(&gt;|z|)    
(Intercept)                1.4378     0.3268   4.399 0.0000109 ***
classif.ranger.prob.good  -2.5287     0.5308  -4.764 0.0000019 ***
classif.ranger.prob.bad        NA         NA      NA        NA    
classif.kknn.prob.good    -0.8385     0.3418  -2.454    0.0141 *  
classif.kknn.prob.bad          NA         NA      NA        NA    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1221.7  on 999  degrees of freedom
Residual deviance: 1168.6  on 997  degrees of freedom
AIC: 1174.6

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<ul>
<li>The Random Forest (<code>ranger</code>) contributes more to the outcome, as one would expect, because it is generally a stronger model.</li>
</ul>
<h2 id="robustify-preventing-new-prediction-factor-levels-and-other-problems">Robustify: Preventing new Prediction Factor Levels and other Problems</h2>
<ul>
<li>Let’s shift contexts: We take the full German Credit dataset.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
task = tsk(&quot;german_credit&quot;)

task$head()</code></pre>
<pre><code>
   credit_risk age amount                           credit_history duration
1:        good  67   1169  critical account/other credits existing        6
2:         bad  22   5951 existing credits paid back duly till now       48
3:        good  49   2096  critical account/other credits existing       12
4:        good  45   7882 existing credits paid back duly till now       42
5:         bad  53   4870          delay in paying off in the past       24
6:        good  35   9055 existing credits paid back duly till now       36
   employment_duration foreign_worker  housing installment_rate
1:      ... &gt;= 7 years            yes      own                4
2:  1 &lt;= ... &lt; 4 years            yes      own                2
3:  4 &lt;= ... &lt; 7 years            yes      own                2
4:  4 &lt;= ... &lt; 7 years            yes for free                2
5:  1 &lt;= ... &lt; 4 years            yes for free                3
6:  1 &lt;= ... &lt; 4 years            yes for free                2
                         job number_credits other_debtors
1: skilled employee/official              2          none
2: skilled employee/official              1          none
3:      unskilled - resident              1          none
4: skilled employee/official              1     guarantor
5: skilled employee/official              2          none
6:      unskilled - resident              1          none
   other_installment_plans people_liable                 personal_status_sex
1:                    none             1                       male : single
2:                    none             1 female : divorced/separated/married
3:                    none             2                       male : single
4:                    none             2                       male : single
5:                    none             2                       male : single
6:                    none             2                       male : single
   present_residence                                          property
1:                 4                                       real estate
2:                 2                                       real estate
3:                 3                                       real estate
4:                 4 building society savings agreement/life insurance
5:                 4                               unknown/no property
6:                 4                               unknown/no property
               purpose                    savings              status telephone
1: domestic appliances unknown/no savings account          ... &lt; 0 DM       yes
2: domestic appliances               ... &lt; 100 DM   0 &lt;= ... &lt; 200 DM        no
3:          retraining               ... &lt; 100 DM no checking account        no
4:    radio/television               ... &lt; 100 DM          ... &lt; 0 DM        no
5:           car (new)               ... &lt; 100 DM          ... &lt; 0 DM        no
6:          retraining unknown/no savings account no checking account       yes</code></pre>
</div>
<ul>
<li>When training with a small datasset, or datasets with many factor levels, it is possible that not all possible factor levels are visible to the <code>Learner</code> during training. Prediction then fails because the <code>Learner</code> does not know how to handle unseen factor levels.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
logreg = lrn(&quot;classif.log_reg&quot;)
logreg$train(task$clone()$filter(1:30))
logreg$predict(task)</code></pre>
<pre><code>
Error in model.frame.default(Terms, newdata, na.action = na.action, xlev = object$xlevels): factor job has new levels unemployed/unskilled - non-resident</code></pre>
</div>
<ul>
<li>Many <code>Learner</code>s can not handle new levels during prediction <span class="math inline">\(\Rightarrow\)</span> we use the <code>"fixfactors"</code> <code>PipeOp</code> to prevent that</li>
<li><code>"fixfactors"</code> introduces <code>NA</code> values; we may need to impute afterwards.
<ul>
<li><span class="math inline">\(\Rightarrow\)</span> We use <code>"imputesample"</code>, but with <code>affect_cols</code> set to only <em>factorial</em> features.</li>
</ul></li>
<li>Columns that are all-constant may also be a problem:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
logreg = lrn(&quot;classif.log_reg&quot;)
logreg$train(task$clone()$filter(1:2))</code></pre>
<pre><code>
Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels</code></pre>
</div>
<ul>
<li>This can be fixed using <code>"removeconstants"</code></li>
<li>We get the following robustification pipeline:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
robustify = po(&quot;fixfactors&quot;) %&gt;&gt;%
  po(&quot;removeconstants&quot;) %&gt;&gt;%
  po(&quot;imputesample&quot;, affect_columns = selector_type(c(&quot;ordered&quot;, &quot;factor&quot;)))

robustify$plot()</code></pre>
<p><img src="2020-03-11-mlr3pipelines-tutorial-german-credit_files/figure-html5/unnamed-chunk-30-1.png" width="624" /></p>
</div>
<ul>
<li>This works even in very pathological conditions.</li>
<li>You may need to combine it with imputation if the data could have missing values.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
roblogreg = GraphLearner$new(robustify %&gt;&gt;% logreg)

roblogreg$train(task$clone()$filter(1:2))
roblogreg$predict(task)</code></pre>
<pre><code>
&lt;PredictionClassif&gt; for 1000 observations:
    row_id truth response
         1  good     good
         2   bad      bad
         3  good     good
---                      
       998  good      bad
       999   bad      bad
      1000  good      bad</code></pre>
</div>
<h2 id="encoding-categorical-features">Encoding Categorical Features</h2>
<p>Some <code>Learner</code>s, even important ones like <code>xgboost</code>, can not handle categorical features.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
xgb = lrn(&quot;classif.xgboost&quot;)
xgb$train(task)</code></pre>
<pre><code>
Error: &lt;TaskClassif:german_credit&gt; has the following unsupported feature types: factor, ordered</code></pre>
</div>
<ul>
<li>Use <code>po("encode")</code>, or <code>po("encodeimpact")</code> to perform factor encoding.
<ul>
<li><code>"encode"</code> does one-hot encoding or similar</li>
<li><code>"encodeimpact"</code> does impact-encoding, which may work better for features with many factor levels</li>
</ul></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
xgb_all = GraphLearner$new(po(&quot;encode&quot;) %&gt;&gt;% xgb)

xgb_all$train(task) # runs without error</code></pre>
</div>
<h2 id="your-ideas">Your Ideas!</h2>
<ul>
<li>Try different methods for preprocessing and training</li>
<li>Some hints:
<ul>
<li>It is not allowed to have two <code>PipeOp</code>s with the same <code>ID</code> in a <code>Graph</code>. Initialize a <code>PipeOp</code> with <code>po("...", id = "xyz")</code> to change its ID on construction</li>
<li>If you build large <code>Graph</code>s involving complicated optimizations, like too many <code>"learner_cv"</code>, then they may need a long time to train</li>
<li>Use the <code>affect_columns</code> parameter if you want a <code>PipeOp</code> to only operate on part of the data. Use <code>po("select")</code> if you want to remove certain columns (possibly only along a single branch of multiple parallel branches). Both take <code>selector_XXX()</code> arguments, e.g. <code>selector_type("integer")</code></li>
<li>You may get the best performance if you actually inspect the features and see what kind of transformations work best for them.</li>
<li>See what <code>PipeOp</code>s are available by inspecting <code>mlr_pipeops$keys()</code>, and get help about them using <code>?mlr_pipeops_XXX</code>.</li>
</ul></li>
</ul>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
