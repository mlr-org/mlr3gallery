<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.67.0" />


<title>Select uncorrelated features - mlr3 gallery</title>
<meta property="og:title" content="Select uncorrelated features - mlr3 gallery">


  <link href='/favicon.ico' rel='icon' type='image/x-icon'/>



  








<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/gruvbox-dark.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">

<link rel="stylesheet" href="/css/custom.css">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/logo.png"
         width="50"
         height="50"
         alt="mlr logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="https://github.com/mlr-org/mlr3gallery">GitHub</a></li>
    
    <li><a href="https://mlr3.mlr-org.com">mlr3</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">3 min read</span>
    

    <h1 class="article-title">Select uncorrelated features</h1>

    
    <span class="article-date">2020-02-25 by Martin Binder &amp; Florian Pfisterer</span>
    

    <div class="article-content">
      


<p>The following example describes a situation where we aim to remove <strong>correlated features</strong>. This in essence means, that we drop features until no features have a correlation higher then a given <code>cutoff</code>. This is often useful when we for example want to use <strong>linear models</strong>.</p>
<div id="prerequisites" class="section level2">
<h2>Prerequisites</h2>
<p>This tutorial assumes familiarity with the basics of <a href="https://mlr3pipelines.mlr-org.com">mlr3pipelines</a>. Consult the <a href="https://mlr3book.mlr-org.com/pipelines.html">mlr3book</a> if some aspects are not fully understandable. Additionally, we compare different cutoff values via tuning using the <a href="https://mlr3tuning.mlr-org.com">mlr3tuning</a> package. Again, the <a href="https://mlr3book.mlr-org.com/paradox.html">mlr3book</a> has an intro to <a href="https://mlr3tuning.mlr-org.com">mlr3tuning</a> and <a href="https://paradox.mlr-org.com">paradox</a>.</p>
<p>The example describes a very involved use-case, where the behavior of <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_select.html"><code>PipeOpSelect</code></a> is manipulated via a <strong>trafo</strong> on itâ€™s <a href="https://paradox.mlr-org.com/reference/ParamSet.html"><code>ParamSet</code></a></p>
</div>
<div id="getting-started" class="section level2">
<h2>Getting started</h2>
<pre class="r"><code>library(&quot;mlr3&quot;)
library(&quot;mlr3pipelines&quot;)
library(&quot;paradox&quot;)
library(&quot;mlr3tuning&quot;)</code></pre>
<p>The basic pipeline looks as follows: We use <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_select.html"><code>PipeOpSelect</code></a> to select a set of variables followed by a <a href="https://mlr3.mlr-org.com/reference/mlr_learners_classif.rpart.html"><code>rpart learner</code></a>.</p>
<pre class="r"><code>pipeline = po(&quot;select&quot;) %&gt;&gt;% lrn(&quot;classif.rpart&quot;)</code></pre>
<p>Now we get to the magic:</p>
<p>We want to use the function <a href="https://www.rdocumentation.org/packages/caret/topics/findCorrelation"><code>caret::findCorrelation</code></a> from the <a href="https://cran.r-project.org/package=caret">caret</a> package in order to select uncorrelated variables. This function has a <code>cutoff</code> parameter, that specifies the maximum correlation allowed between variables. In order to expose this variable as a <code>numeric</code> parameter we can tune over we specify the following <a href="https://paradox.mlr-org.com/reference/ParamSet.html"><code>ParamSet</code></a>:</p>
<pre class="r"><code>ps = ParamSet$new(list(ParamDbl$new(&quot;cutoff&quot;, 0, 1)))</code></pre>
<p>We define a function <code>select_cutoff</code> that takes as input a <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a> and returns a list of features we aim to keep.</p>
<p>Now we use a <code>trafo</code> to transform the <code>cutoff</code> into a set of variables, which is what <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_select.html"><code>PipeOpSelect</code></a> can work with. Note that we use <code>x$cutoff = NULL</code> in order to remove the temporary parameter we introduced, as <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_select.html"><code>PipeOpSelect</code></a> does not know what to do with it.</p>
<pre class="r"><code>ps$trafo = function(x, param_set) {
  cutoff = x$cutoff
  x$select.selector = function(task) {
    fn = task$feature_names
    data = task$data(cols = fn)
    drop = caret::findCorrelation(cor(data), cutoff = cutoff, exact = TRUE, names = TRUE)
    setdiff(fn, drop)
  }
  x$cutoff = NULL
  x
}</code></pre>
<p>If you are not sure, you understand the <code>trafo</code> concept, consult the <a href="https://mlr3book.mlr-org.com/paradox.html">mlr3book</a>. It has a section on the <code>trafo</code> concept.</p>
<p>To now tune over different values for <code>cutoff</code>, we first create a <a href="https://mlr3tuning.mlr-org.com/reference/TuningInstance.html"><code>TuningInstance</code></a>.</p>
<pre class="r"><code>inst = TuningInstance$new(
  task = tsk(&quot;iris&quot;),
  learner = pipeline,
  resampling = rsmp(&quot;cv&quot;, folds = 3L),
  measures = msr(&quot;classif.ce&quot;),
  param_set = ps,
  terminator = term(&quot;none&quot;),
  # don&#39;t need the following line for optimization, this is for
  # demonstration that different features were selected
  bm_args = list(store_models = TRUE)
)</code></pre>
<p>and run the tuning:</p>
<pre class="r"><code>tnr(&quot;grid_search&quot;)$tune(inst)</code></pre>
<p>In order to demonstrate that different cutoff values result in different features being selected, we can run the following to inspect the trained models. Note this inspects only the trained models of the first CV fold of each evaluated model. The features being excluded depends on the training data seen by the pipeline and may be different in different folds, even at the same cutoff value</p>
<pre class="r"><code>inst$archive(unnest = &quot;tune_x&quot;)[order(cutoff),
  list(cutoff, classif.ce,
    featurenames = lapply(resample_result, function(x)
      x$learners[[1]]$model$classif.rpart$train_task$feature_names
  ))]</code></pre>
<pre><code>##        cutoff classif.ce                                      featurenames
##  1: 0.0000000 0.28666667                                      Sepal.Length
##  2: 0.1111111 0.28000000                                      Sepal.Length
##  3: 0.2222222 0.28000000                          Sepal.Length,Sepal.Width
##  4: 0.3333333 0.28000000                          Sepal.Length,Sepal.Width
##  5: 0.4444444 0.28000000                          Sepal.Length,Sepal.Width
##  6: 0.5555556 0.28000000                          Sepal.Length,Sepal.Width
##  7: 0.6666667 0.28000000                          Sepal.Length,Sepal.Width
##  8: 0.7777778 0.28000000                          Sepal.Length,Sepal.Width
##  9: 0.8888889 0.04666667              Petal.Width,Sepal.Length,Sepal.Width
## 10: 1.0000000 0.05333333 Petal.Length,Petal.Width,Sepal.Length,Sepal.Width</code></pre>
<p>Voila, we created our own <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html"><code>PipeOp</code></a>, that uses very advanced knowledge of <a href="https://mlr3pipelines.mlr-org.com">mlr3pipelines</a> and <a href="https://paradox.mlr-org.com">paradox</a> in only few lines of code.</p>
</div>

    </div>
  </article>

  


</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/images/hugo-logo.png" alt="Img link to Hugo website" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
  </body>
</html>

