<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
<title>mlr3gallery: mlr3pipelines Tutorial - German Credit</title>

<meta property="description" itemprop="description" content="In this use case, we continue working with the German credit dataset. We already used different Learners on it in previous posts and tried to optimize their hyperparameters. To make things interesting, we artificially introduce missing values into the dataset, perform imputation and filtering and stack Learners."/>

<link rel="canonical" href="https://mlr3gallery.mlr-org.com/posts/2020-03-11-mlr3pipelines-tutorial-german-credit/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2020-03-11"/>
<meta property="article:created" itemprop="dateCreated" content="2020-03-11"/>
<meta name="article:author" content="Martin Binder"/>
<meta name="article:author" content="Florian Pfisterer"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="mlr3gallery: mlr3pipelines Tutorial - German Credit"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="In this use case, we continue working with the German credit dataset. We already used different Learners on it in previous posts and tried to optimize their hyperparameters. To make things interesting, we artificially introduce missing values into the dataset, perform imputation and filtering and stack Learners."/>
<meta property="og:url" content="https://mlr3gallery.mlr-org.com/posts/2020-03-11-mlr3pipelines-tutorial-german-credit/"/>
<meta property="og:image" content="https://mlr3gallery.mlr-org.com/posts/2020-03-11-mlr3pipelines-tutorial-german-credit/2020-03-11-mlr3pipelines-tutorial-german-credit_files/figure-html5/unnamed-chunk-19-1.png"/>
<meta property="og:image:width" content="1248"/>
<meta property="og:image:height" content="768"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="mlr3gallery"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="mlr3gallery: mlr3pipelines Tutorial - German Credit"/>
<meta property="twitter:description" content="In this use case, we continue working with the German credit dataset. We already used different Learners on it in previous posts and tried to optimize their hyperparameters. To make things interesting, we artificially introduce missing values into the dataset, perform imputation and filtering and stack Learners."/>
<meta property="twitter:url" content="https://mlr3gallery.mlr-org.com/posts/2020-03-11-mlr3pipelines-tutorial-german-credit/"/>
<meta property="twitter:image" content="https://mlr3gallery.mlr-org.com/posts/2020-03-11-mlr3pipelines-tutorial-german-credit/2020-03-11-mlr3pipelines-tutorial-german-credit_files/figure-html5/unnamed-chunk-19-1.png"/>
<meta property="twitter:image:width" content="1248"/>
<meta property="twitter:image:height" content="768"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="mlr3gallery: mlr3pipelines Tutorial - German Credit"/>
<meta name="citation_fulltext_html_url" content="https://mlr3gallery.mlr-org.com/posts/2020-03-11-mlr3pipelines-tutorial-german-credit/"/>
<meta name="citation_online_date" content="2020/03/11"/>
<meta name="citation_publication_date" content="2020/03/11"/>
<meta name="citation_author" content="Martin Binder"/>
<meta name="citation_author" content="Florian Pfisterer"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","categories","author","date","description","output","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["mlr3pipelines Tutorial - German Credit"]},{"type":"character","attributes":{},"value":["mlr3pipelines","imputation","filtering","stacking","german credit"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Martin Binder"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Florian Pfisterer"]}]}]},{"type":"character","attributes":{},"value":["03-11-2020"]},{"type":"character","attributes":{},"value":["In this use case, we continue working with the German credit dataset. We already used different Learners on it in previous posts and tried to optimize their hyperparameters. To make things interesting, we artificially introduce missing values into the dataset, perform imputation and filtering and stack Learners."]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","css"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["../../custom.css"]}]}]},{"type":"character","attributes":{},"value":["https://mlr3gallery.mlr-org.com/posts/2020-03-11-mlr3pipelines-tutorial-german-credit/"]},{"type":"character","attributes":{},"value":["https://mlr3gallery.mlr-org.com/posts/2020-03-11-mlr3pipelines-tutorial-german-credit/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["2020-03-11-mlr3pipelines-tutorial-german-credit_files/figure-html5/unnamed-chunk-19-1.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/figure-html5/unnamed-chunk-21-1.png","2020-03-11-mlr3pipelines-tutorial-german-credit_files/figure-html5/unnamed-chunk-27-1.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #455a64;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative;}
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

</style>

<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for table of contents */

.d-toc {
  color: rgba(0,0,0,0.8);
  font-size: 0.8em;
  line-height: 1em;
}

.d-toc-header {
  font-size: 0.6rem;
  font-weight: 400;
  color: rgba(0, 0, 0, 0.5);
  text-transform: uppercase;
  margin-top: 0;
  margin-bottom: 1.3em;
}

.d-toc a {
  border-bottom: none;
}

.d-toc ul {
  padding-left: 0;
}

.d-toc li>ul {
  padding-top: 0.8em;
  padding-left: 16px;
  margin-bottom: 0.6em;
}

.d-toc ul,
.d-toc li {
  list-style-type: none;
}

.d-toc li {
  margin-bottom: 0.9em;
}

.d-toc-separator {
  margin-top: 20px;
  margin-bottom: 2em;
}

.d-article-with-toc {
  border-top: none;
  padding-top: 0;
}



/* Tweak code blocks (note that this CSS is repeated above in an injection
   into the d-code shadow dom) */

d-code {
  overflow-x: auto !important;
}

pre.d-code code.d-code {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

pre.text-output {

  font-size: 12px;
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

@media(min-width: 768px) {

d-code {
  overflow-x: visible !important;
}

pre.d-code code.d-code  {
    padding-left: 18px;
    font-size: 14px;
}
pre.text-output {
  font-size: 14px;
}
}

/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}



/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}


/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // create d-bibliography
  var bibliography = $('<d-bibliography></d-bibliography>');
  $('#distill-bibliography').wrap(bibliography);

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace citations with <d-cite>
  $('.citation').each(function(i, val) {
    appendix = true;
    var cites = $(this).attr('data-cites').split(" ");
    var dt_cite = $('<d-cite></d-cite>');
    dt_cite.attr('key', cites.join());
    $(this).replaceWith(dt_cite);
  });
  // remove refs
  $('#refs').remove();

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-toc a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // replace code blocks with d-code
  $('pre>code').each(function(i, val) {
    var code = $(this);
    var pre = code.parent();
    var clz = "";
    var language = pre.attr('class');
    if (language) {
      // map unknown languages to "clike" (without this they just dissapear)
      if ($.inArray(language, ["bash", "clike", "css", "go", "html",
                               "javascript", "js", "julia", "lua", "markdown",
                               "markup", "mathml", "python", "svg", "xml"]) == -1)
        language = "clike";
      language = ' language="' + language + '"';
      var dt_code = $('<d-code block' + language + clz + '></d-code>');
      dt_code.text(code.text());
      pre.replaceWith(dt_code);
    } else {
      code.addClass('text-output').unwrap().changeElementType('pre');
    }
  });

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('d-code, pre.text-output, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // table of contents
    if (have_authors) // adjust border if we are in authors
      $('.d-toc').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // inject pre code styles (can't do this with a global stylesheet b/c a shadow root is used)
    $('d-code').each(function(i, val) {
      var style = document.createElement('style');
      style.innerHTML = 'pre code { padding-left: 10px; font-size: 12px; border-left: 2px solid rgba(0,0,0,0.1); } ' +
                        '@media(min-width: 768px) { pre code { padding-left: 18px; font-size: 14px; } }';
      if (this.shadowRoot)
        this.shadowRoot.appendChild(style);
    });

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-toc-header').remove();
  $('.d-toc').remove();
  $('.d-toc-separator').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="../../custom.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"mlr3pipelines Tutorial - German Credit","description":"In this use case, we continue working with the German credit dataset. We already used different Learners on it in previous posts and tried to optimize their hyperparameters. To make things interesting, we artificially introduce missing values into the dataset, perform imputation and filtering and stack Learners.","authors":[{"author":"Martin Binder","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#"},{"author":"Florian Pfisterer","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#"}],"publishedDate":"2020-03-11T00:00:00.000+00:00","citationText":"Binder & Pfisterer, 2020"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="https://mlr3.mlr-org.com">
<img src="../../images/logo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">mlr3gallery</a>
</div>
<div class="nav-right">
<a href="https://github.com/mlr-org/mlr3gallery">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>mlr3pipelines Tutorial - German Credit</h1>
<p><p>In this use case, we continue working with the German credit dataset. We already used different Learners on it in previous posts and tried to optimize their hyperparameters. To make things interesting, we artificially introduce missing values into the dataset, perform imputation and filtering and stack Learners.</p></p>
</div>

<div class="d-byline">
  Martin Binder  
  
,   Florian Pfisterer  
  
<br/>03-11-2020
</div>

<div class="d-article">
<h2 id="outline">Outline</h2>
<p>This is the third part of a serial of use cases with the German credit dataset. The other parts of this series can be found here:</p>
<ul>
<li><a href="https://mlr3gallery.mlr-org.com/posts/2020-03-11-basics-german-credit/">Part I - Basics</a></li>
<li><a href="https://mlr3gallery.mlr-org.com/posts/2020-03-11-mlr3tuning-tutorial-german-credit/">Part II - Tuning</a></li>
</ul>
<p>In this tutorial, we continue working with the German credit dataset. We already used different <code>Learner</code>s on it and tried to optimize their hyperparameters. Now we will do four additional things:</p>
<ol type="1">
<li>We preprocess the data as an integrated step of the model fitting process</li>
<li>We tune the associated preprocessing parameters</li>
<li>We stack multiple <code>Learner</code>s in an <em>ensemble</em> model</li>
<li>We discuss some techniques that make <code>Learner</code>s able to tackle <em>challenging</em> datasets that they could not handle otherwise (we are going to outline what challenging means in particular later on)</li>
</ol>
<h2 id="prerequisites">Prerequisites</h2>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(&quot;data.table&quot;)
library(&quot;ggplot2&quot;)
library(&quot;mlr3&quot;)
library(&quot;mlr3learners&quot;)
library(&quot;mlr3filters&quot;)
library(&quot;mlr3pipelines&quot;)
library(&quot;mlr3tuning&quot;)
library(&quot;paradox&quot;)</code></pre>
</div>
<p>We again use the German credit dataset, but will restrict ourselves to the <em>factorial features</em>. To make things interesting or to make it a bit harder for our <a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learners</code></a>, we introduce <em>missing values</em> in the dataset:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
task = tsk(&quot;german_credit&quot;)
credit_full = task$data()
credit = credit_full[, sapply(credit_full, FUN = is.factor), with = FALSE]

set.seed(20191101)
# sample values to NA
credit = credit[, lapply(.SD, function(x) {
  x[sample(c(TRUE, NA), length(x), replace = TRUE, prob = c(.9, .1))]
})]
credit$credit_risk = credit_full$credit_risk
task = TaskClassif$new(&quot;GermanCredit&quot;, credit, &quot;credit_risk&quot;)</code></pre>
</div>
<p>We instantiate a <code>Resampling</code> instance for this <code>Task</code> to be able to compare resampling performance:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
set.seed(20191101)
cv10_instance = rsmp(&quot;cv&quot;)$instantiate(task)</code></pre>
</div>
<p>You can uncomment the following line if you are running this locally:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# future::plan(&quot;multiprocess&quot;) # uncomment for parallelization</code></pre>
</div>
<h2 id="intro">Intro</h2>
<p>In this use case, we will take a look at composite machine learning algorithms that may incorporate data preprocessing or the combination of multiple <code>Learner</code>s (“ensemble methods”).</p>
<p>We use the <a href="https://mlr3pipelines.mlr-org.com">mlr3pipelines</a> package that enables us to chain <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html"><code>PipeOps</code></a> into data flow <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graphs</code></a>.</p>
<p>Available <code>PipeOp</code>s are listed in the <code>mlr_pipeops</code> dictionary:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
mlr_pipeops</code></pre>
<pre><code>
&lt;DictionaryPipeOp&gt; with 61 stored values
Keys: boxcox, branch, chunk, classbalancing, classifavg, classweights,
  colapply, collapsefactors, copy, datefeatures, encode, encodeimpact,
  encodelmer, featureunion, filter, fixfactors, histbin, ica,
  imputeconstant, imputehist, imputelearner, imputemean, imputemedian,
  imputemode, imputeoor, imputesample, kernelpca, learner, learner_cv,
  missind, modelmatrix, multiplicityexply, multiplicityimply, mutate,
  nmf, nop, ovrsplit, ovrunite, pca, proxy, quantilebin,
  randomresponse, regravg, removeconstants, renamecolumns, replicate,
  scale, scalemaxabs, scalerange, select, smote, spatialsign,
  subsample, targetinvert, targetmutate, targettrafoscalerange,
  textvectorizer, threshold, tunethreshold, unbranch, yeojohnson</code></pre>
</div>
<h2 id="missing-value-imputation">Missing Value Imputation</h2>
<p>We have just introduced missing values into our data. While some <code>Learner</code>s can deal with missing value, many cannot. Trying to train a random forest fails because of this:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ranger = lrn(&quot;classif.ranger&quot;)
ranger$train(task)</code></pre>
<pre><code>
Error: Missing data in columns: credit_history, employment_duration, foreign_worker, housing, installment_rate, job, number_credits, other_debtors, other_installment_plans, people_liable, personal_status_sex, present_residence, property, purpose, savings, status, telephone.</code></pre>
</div>
<p>We can perform imputation of missing values using a <code>PipeOp</code>. To find out which imputation <code>PipeOp</code>s are available, we do the following:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
mlr_pipeops$keys(&quot;^impute&quot;)</code></pre>
<pre><code>
[1] &quot;imputeconstant&quot; &quot;imputehist&quot;     &quot;imputelearner&quot;  &quot;imputemean&quot;    
[5] &quot;imputemedian&quot;   &quot;imputemode&quot;     &quot;imputeoor&quot;      &quot;imputesample&quot;  </code></pre>
</div>
<p>We choose to impute factorial features using a new level (via <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_imputeoor.html"><code>PipeOpImputeOOR</code></a>). Let’s use the <code>PipeOp</code> itself to create an imputed <code>Task</code>. This shows us how the <code>PipeOp</code> actually works:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
imputer = po(&quot;imputeoor&quot;)
task_imputed = imputer$train(list(task))[[1]]
task_imputed$missings()</code></pre>
<pre><code>
            credit_risk          credit_history     employment_duration 
                      0                       0                       0 
         foreign_worker                 housing        installment_rate 
                      0                       0                       0 
                    job          number_credits           other_debtors 
                      0                       0                       0 
other_installment_plans           people_liable     personal_status_sex 
                      0                       0                       0 
      present_residence                property                 purpose 
                      0                       0                       0 
                savings                  status               telephone 
                      0                       0                       0 </code></pre>
<pre class="r"><code>
head(task_imputed$data())</code></pre>
<pre><code>
   credit_risk                              credit_history employment_duration
1:        good     all credits at this bank paid back duly            &gt;= 7 yrs
2:         bad no credits taken/all credits paid back duly    1 &lt;= ... &lt; 4 yrs
3:        good     all credits at this bank paid back duly    4 &lt;= ... &lt; 7 yrs
4:        good no credits taken/all credits paid back duly    4 &lt;= ... &lt; 7 yrs
5:         bad    existing credits paid back duly till now    1 &lt;= ... &lt; 4 yrs
6:        good                                    .MISSING    1 &lt;= ... &lt; 4 yrs
   foreign_worker housing installment_rate                       job
1:             no    rent             &lt; 20 skilled employee/official
2:       .MISSING    rent   25 &lt;= ... &lt; 35 skilled employee/official
3:       .MISSING    rent   25 &lt;= ... &lt; 35      unskilled - resident
4:             no     own   25 &lt;= ... &lt; 35 skilled employee/official
5:             no     own   20 &lt;= ... &lt; 25 skilled employee/official
6:             no     own   25 &lt;= ... &lt; 35      unskilled - resident
   number_credits other_debtors other_installment_plans people_liable
1:            2-3          none                    none        0 to 2
2:              1          none                    none        0 to 2
3:       .MISSING          none                    none     3 or more
4:              1      .MISSING                    none     3 or more
5:            2-3      .MISSING                    none     3 or more
6:              1          none                    none     3 or more
                    personal_status_sex present_residence              property
1:                             .MISSING          &gt;= 7 yrs              .MISSING
2: female : non-single or male : single  1 &lt;= ... &lt; 4 yrs unknown / no property
3:                             .MISSING  4 &lt;= ... &lt; 7 yrs unknown / no property
4:               male : married/widowed          &gt;= 7 yrs          car or other
5:               male : married/widowed          &gt;= 7 yrs           real estate
6:               male : married/widowed          &gt;= 7 yrs           real estate
               purpose                    savings
1: furniture/equipment             ... &gt;= 1000 DM
2: furniture/equipment unknown/no savings account
3:             repairs unknown/no savings account
4:          car (used) unknown/no savings account
5:              others unknown/no savings account
6:             repairs             ... &gt;= 1000 DM
                                       status                 telephone
1:                                   .MISSING yes (under customer name)
2:                                 ... &lt; 0 DM                  .MISSING
3: ... &gt;= 200 DM / salary for at least 1 year                        no
4:                        no checking account                  .MISSING
5:                        no checking account                        no
6: ... &gt;= 200 DM / salary for at least 1 year yes (under customer name)</code></pre>
</div>
<p>We do not only need complete data during training but also during prediction. Using the same imputation heuristic for both is the most consistent strategy. This way the imputation strategy can, in fact, be seen as a part of the complete learner (which could be tuned).</p>
<p>If we used the imputed <code>Task</code> for Resampling, we would <em>leak</em> information from the test set into the training set. Therefore, it is mandatory to attach the imputation operator to the <code>Learner</code> itself, creating a <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_learners_graph.html"><code>GraphLearner</code></a>:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
imp_ranger = GraphLearner$new(po(&quot;imputeoor&quot;) %&gt;&gt;% ranger)

imp_ranger$train(task)</code></pre>
</div>
<p>This <code>GraphLearner</code> can be used for resampling – like an ordinary <code>Learner</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
rr = resample(task, learner = imp_ranger, resampling = cv10_instance)
rr$aggregate()</code></pre>
<pre><code>
classif.ce 
     0.254 </code></pre>
</div>
<h2 id="feature-filtering">Feature Filtering</h2>
<p>Typically, sparse models, i.e. having models with few(er) features, are desirable. This is due to a variety of reasons, e.g., enhanced interpretability or decreased costs of acquiring data. Furthermore, sparse models may actually be associated with increased performance (especially if overfitting is anticipated). We can use <em>feature filter</em> to only keep features with the highest <em>information</em>. Filters are implemented in the <a href="https://mlr3filters.mlr-org.com">mlr3filters</a> package and listed in the following dictionary:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
mlr_filters</code></pre>
<pre><code>
&lt;DictionaryFilter&gt; with 18 stored values
Keys: anova, auc, carscore, cmim, correlation, disr, find_correlation,
  importance, information_gain, jmi, jmim, kruskal_test, mim, mrmr,
  njmim, performance, permutation, variance</code></pre>
</div>
<p>We apply the <a href="https://mlr3filters.mlr-org.com/reference/mlr_filters_mim.html"><code>FilterMIM</code></a> (mutual information maximization) <code>Filter</code> as implemented in the <a href="https://cran.r-project.org/package=praznik">praznik</a> package. This <code>Filter</code> allows for the selection of the top-<code>k</code> features of best mutual information.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
filter = flt(&quot;mim&quot;)
filter$calculate(task_imputed)$scores</code></pre>
<pre><code>
                 status          credit_history                 savings 
           0.0560477846            0.0272292095            0.0162383750 
                purpose                property                 housing 
           0.0145509110            0.0117234634            0.0114749476 
    employment_duration     personal_status_sex other_installment_plans 
           0.0085307023            0.0056389930            0.0052711015 
          other_debtors          foreign_worker       present_residence 
           0.0032857631            0.0030732135            0.0018579748 
       installment_rate           people_liable          number_credits 
           0.0016124103            0.0014452494            0.0010182556 
              telephone                     job 
           0.0006202092            0.0003274007 </code></pre>
</div>
<p>Making use of this <code>Filter</code>, you may wonder at which costs the reduction of the feature space comes. We can investigate the trade-off between features and performance by tuning. We incorporate our filtering strategy into the pipeline using <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_filter.html"><code>PipeOpFilter</code></a>. Like before, we need to perform imputation as the <code>Filter</code> also relies on complete data:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
fpipe = po(&quot;imputeoor&quot;) %&gt;&gt;% po(&quot;filter&quot;, flt(&quot;mim&quot;), filter.nfeat = 3)
fpipe$train(task)[[1]]$head()</code></pre>
<pre><code>
   credit_risk                              credit_history
1:        good     all credits at this bank paid back duly
2:         bad no credits taken/all credits paid back duly
3:        good     all credits at this bank paid back duly
4:        good no credits taken/all credits paid back duly
5:         bad    existing credits paid back duly till now
6:        good                                    .MISSING
                      savings                                     status
1:             ... &gt;= 1000 DM                                   .MISSING
2: unknown/no savings account                                 ... &lt; 0 DM
3: unknown/no savings account ... &gt;= 200 DM / salary for at least 1 year
4: unknown/no savings account                        no checking account
5: unknown/no savings account                        no checking account
6:             ... &gt;= 1000 DM ... &gt;= 200 DM / salary for at least 1 year</code></pre>
</div>
<p>We can now tune over the <code>mim.filter.nfeat</code> parameter. It steers how many features are kept by the <code>Filter</code> and eventually used by the learner:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
searchspace = ParamSet$new(list(
  ParamInt$new(&quot;mim.filter.nfeat&quot;, lower = 1, upper = length(task$feature_names))
))</code></pre>
</div>
<p>The problem is one-dimensional (i.e. only one parameter is tuned). Thus, we make use of a grid search. For higher dimensions, strategies like random search are more appropriate:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
inst = TuningInstanceSingleCrit$new(
  task, fpipe %&gt;&gt;% lrn(&quot;classif.ranger&quot;), cv10_instance, msr(&quot;classif.ce&quot;),
  searchspace, trm(&quot;none&quot;)
)
tuner = tnr(&quot;grid_search&quot;)</code></pre>
</div>
<p>The tuning procedure may take some time:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
tuner$optimize(inst)</code></pre>
<pre><code>
   mim.filter.nfeat learner_param_vals  x_domain classif.ce
1:               12          &lt;list[4]&gt; &lt;list[1]&gt;      0.247</code></pre>
</div>
<p>We can plot the performance against the number of features. If we do so, we see the possible trade-off between sparsity and predictive performance:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
arx = inst$archive$data()
ggplot(arx, aes(x = mim.filter.nfeat, y = classif.ce)) + geom_line()</code></pre>
<p><img src="2020-03-11-mlr3pipelines-tutorial-german-credit_files/figure-html5/unnamed-chunk-19-1.png" width="624" /></p>
</div>
<h2 id="stacking">Stacking</h2>
<p>We want to build a model that is based on the predictions of other <code>Learner</code>s. This means that we are in the state that we need predictions already during training. This is a very specific case that is luckily handled by <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_learner_cv.html"><code>PipeOpLearnerCV</code></a>. <code>PipeOpLearnerCV</code> performs cross-validation during the training phase and returns the cross-validated predictions. We use <code>"prob"</code> predictions because they carry more information than response prediction:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
stackgraph = po(&quot;imputeoor&quot;) %&gt;&gt;%
  gunion(list(
    po(&quot;learner_cv&quot;, lrn(&quot;classif.ranger&quot;, predict_type = &quot;prob&quot;)),
    po(&quot;learner_cv&quot;, lrn(&quot;classif.kknn&quot;, predict_type = &quot;prob&quot;)))) %&gt;&gt;%
  po(&quot;featureunion&quot;) %&gt;&gt;% lrn(&quot;classif.log_reg&quot;)</code></pre>
</div>
<p>We built a pretty complex <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a> already. Therefore, we plot it:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
stackgraph$plot()</code></pre>
<p><img src="2020-03-11-mlr3pipelines-tutorial-german-credit_files/figure-html5/unnamed-chunk-21-1.png" width="624" /></p>
</div>
<p>We now compare the performance of the stacked learner to the performance of the individual <code>Learner</code>s:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
bmr = benchmark(data.table(
  task = list(task),
  learner = list(
    stackgraph,
    GraphLearner$new(po(&quot;imputeoor&quot;) %&gt;&gt;% lrn(&quot;classif.ranger&quot;)),
    GraphLearner$new(po(&quot;imputeoor&quot;) %&gt;&gt;% lrn(&quot;classif.kknn&quot;)),
    GraphLearner$new(po(&quot;imputeoor&quot;) %&gt;&gt;% lrn(&quot;classif.log_reg&quot;))),
  resampling = list(cv10_instance)))
bmr$aggregate()[, c(&quot;learner_id&quot;, &quot;classif.ce&quot;)]</code></pre>
<pre><code>
                                                           learner_id
1: imputeoor.classif.ranger.classif.kknn.featureunion.classif.log_reg
2:                                           imputeoor.classif.ranger
3:                                             imputeoor.classif.kknn
4:                                          imputeoor.classif.log_reg
   classif.ce
1:      0.256
2:      0.259
3:      0.323
4:      0.284</code></pre>
</div>
<p>If we train the stacked learner and look into the final <code>Learner</code> (the logistic regression), we can see how “important” each <code>Learner</code> of the stacked learner is:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
stackgraph$train(task)</code></pre>
<pre><code>
$classif.log_reg.output
NULL</code></pre>
<pre class="r"><code>
summary(stackgraph$pipeops$classif.log_reg$state$model)</code></pre>
<pre><code>
Call:
stats::glm(formula = task$formula(), family = &quot;binomial&quot;, data = task$data(), 
    model = FALSE)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.2196  -0.7843  -0.5441   0.9380   2.3104  

Coefficients: (2 not defined because of singularities)
                         Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                3.1103     0.3359   9.260  &lt; 2e-16 ***
classif.ranger.prob.good  -5.0988     0.5525  -9.228  &lt; 2e-16 ***
classif.ranger.prob.bad        NA         NA      NA       NA    
classif.kknn.prob.good    -0.8452     0.3232  -2.615  0.00892 ** 
classif.kknn.prob.bad          NA         NA      NA       NA    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1221.7  on 999  degrees of freedom
Residual deviance: 1050.7  on 997  degrees of freedom
AIC: 1056.7

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<p>The random forest has a higher contribution.</p>
<h2 id="robustify-preventing-new-prediction-factor-levels-and-other-problems">Robustify: Preventing new Prediction Factor Levels and other Problems</h2>
<p>We now shift the context, using the complete German credit dataset:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
task = tsk(&quot;german_credit&quot;)</code></pre>
</div>
<p>There is a potential practical problem for both, small data sets and data sets with covariates having many factor levels: It may occur that not all possible factor levels have been used by the <code>Learner</code> during training. This happens because these rare instances are simply not sampled. The prediction then may fail because the <code>Learner</code> does not know how to handle unseen factor levels:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
task_unseen = task$clone()$filter(1:30)
logreg = lrn(&quot;classif.log_reg&quot;)
logreg$train(task_unseen)
logreg$predict(task)</code></pre>
<pre><code>
Error in model.frame.default(Terms, newdata, na.action = na.action, xlev = object$xlevels): factor job has new levels unemployed/unskilled - non-resident</code></pre>
</div>
<p>Not only logistic regression but also many other <code>Learner</code>s cannot handle new levels during prediction. Thus, we use <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_fixfactors.html"><code>PipeOpFixFactors</code></a> to prevent that. <code>PipeOpFixFactors</code> introduces <code>NA</code> values for unseen levels. This means that we may need to impute afterwards. To solve this issue we can use <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_imputesample.html"><code>PipeOpImputeSample</code></a>, but with <code>affect_columns</code> set to only <em>factorial</em> features.</p>
<p>Another observation is that all-constant features may also be a problem:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
task_constant = task$clone()$filter(1:2)
logreg = lrn(&quot;classif.log_reg&quot;)
logreg$train(task_constant)</code></pre>
<pre><code>
Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels</code></pre>
</div>
<p>This can be fixed using <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_removeconstants.html"><code>PipeOpRemoveConstants</code></a>.</p>
<p>Both, handling unseen levels and all-constant features can be handled simultaneously using the following <code>Graph</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
robustify = po(&quot;fixfactors&quot;) %&gt;&gt;%
  po(&quot;removeconstants&quot;) %&gt;&gt;%
  po(&quot;imputesample&quot;, affect_columns = selector_type(c(&quot;ordered&quot;, &quot;factor&quot;)))

robustify$plot()</code></pre>
<p><img src="2020-03-11-mlr3pipelines-tutorial-german-credit_files/figure-html5/unnamed-chunk-27-1.png" width="624" /></p>
</div>
<p>This robust learner works even in very pathological conditions:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
roblogreg = GraphLearner$new(robustify %&gt;&gt;% logreg)

roblogreg$train(task_constant)
roblogreg$predict(task)</code></pre>
<pre><code>
&lt;PredictionClassif&gt; for 1000 observations:
    row_id truth response
         1  good     good
         2   bad      bad
         3  good     good
---                      
       998  good      bad
       999   bad      bad
      1000  good      bad</code></pre>
</div>
<h2 id="your-ideas">Your Ideas</h2>
<p>There are various possibilities for preprocessing with <code>PipeOp</code>s. You can try different methods for preprocessing and training. Feel free to discover this variety by yourself! Here are only a few hints that help when working with <code>PipeOp</code>s:</p>
<ul>
<li>It is not allowed to have two <code>PipeOp</code>s with the same <code>ID</code> in a <code>Graph</code>
<ul>
<li>Initialize a <code>PipeOp</code> with <code>po("...", id = "xyz")</code> to change its ID on construction</li>
</ul></li>
<li>If you build large <code>Graph</code>s involving complicated optimizations, like many <code>"learner_cv"</code>, they may need a long time to train</li>
<li>Use the <code>affect_columns</code> parameter if you want a <code>PipeOp</code> to only operate on part of the data</li>
<li>Use <code>po("select")</code> if you want to remove certain columns (possibly only along a single branch of multiple parallel branches). Both take <code>selector_xxx()</code> arguments, e.g. <code>selector_type("integer")</code></li>
<li>You may get the best performance if you actually inspect the features and see what kind of transformations work best for them (know your data!)</li>
<li>See what <code>PipeOp</code>s are available by inspecting <code>mlr_pipeops$keys()</code>, and get help about them using <code>?mlr_pipeops_xxx</code></li>
</ul>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Binder &amp; Pfisterer (2020, March 11). mlr3gallery: mlr3pipelines Tutorial - German Credit. Retrieved from https://mlr3gallery.mlr-org.com/posts/2020-03-11-mlr3pipelines-tutorial-german-credit/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{binder2020mlr3pipelines,
  author = {Binder, Martin and Pfisterer, Florian},
  title = {mlr3gallery: mlr3pipelines Tutorial - German Credit},
  url = {https://mlr3gallery.mlr-org.com/posts/2020-03-11-mlr3pipelines-tutorial-german-credit/},
  year = {2020}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
