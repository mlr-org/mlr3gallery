<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #545454; font-weight: bold; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #a1024a; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007faa; font-weight: bold; } /* ControlFlow */
code span.ch { color: #008000; } /* Char */
code span.cn { color: #d91e18; } /* Constant */
code span.co { color: #545454; } /* Comment */
code span.cv { color: #545454; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #aa5d00; } /* DataType */
code span.dv { color: #a1024a; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #a1024a; } /* Float */
code span.fu { color: #4254a7; } /* Function */
code span.im { } /* Import */
code span.in { color: #545454; font-weight: bold; } /* Information */
code span.kw { color: #007faa; font-weight: bold; } /* Keyword */
code span.op { color: #696969; } /* Operator */
code span.ot { color: #007faa; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #008000; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #008000; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #008000; } /* VerbatimString */
code span.wa { color: #545454; font-weight: bold; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>mlr3gallery: Bike Sharing Demand - Use Case</title>

<meta property="description" itemprop="description" content="This use case provides an example on tuning and benchmarking in mlr3verse using data from Capital Bikeshare."/>

<link rel="canonical" href="https://mlr3gallery.mlr-org.com/posts/2020-07-27-bikesharing-demand/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2020-07-27"/>
<meta property="article:created" itemprop="dateCreated" content="2020-07-27"/>
<meta name="article:author" content="Henri Funk"/>
<meta name="article:author" content="Andreas Hofheinz"/>
<meta name="article:author" content="Marius Girnat"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="mlr3gallery: Bike Sharing Demand - Use Case"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="This use case provides an example on tuning and benchmarking in mlr3verse using data from Capital Bikeshare."/>
<meta property="og:url" content="https://mlr3gallery.mlr-org.com/posts/2020-07-27-bikesharing-demand/"/>
<meta property="og:image" content="https://mlr3gallery.mlr-org.com/posts/2020-07-27-bikesharing-demand/2020-07-27-bikesharing-demand_files/figure-html5/dense-1.png"/>
<meta property="og:image:width" content="1248"/>
<meta property="og:image:height" content="633"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="mlr3gallery"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="mlr3gallery: Bike Sharing Demand - Use Case"/>
<meta property="twitter:description" content="This use case provides an example on tuning and benchmarking in mlr3verse using data from Capital Bikeshare."/>
<meta property="twitter:url" content="https://mlr3gallery.mlr-org.com/posts/2020-07-27-bikesharing-demand/"/>
<meta property="twitter:image" content="https://mlr3gallery.mlr-org.com/posts/2020-07-27-bikesharing-demand/2020-07-27-bikesharing-demand_files/figure-html5/dense-1.png"/>
<meta property="twitter:image:width" content="1248"/>
<meta property="twitter:image:height" content="633"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="mlr3gallery: Bike Sharing Demand - Use Case"/>
<meta name="citation_fulltext_html_url" content="https://mlr3gallery.mlr-org.com/posts/2020-07-27-bikesharing-demand/"/>
<meta name="citation_online_date" content="2020/07/27"/>
<meta name="citation_publication_date" content="2020/07/27"/>
<meta name="citation_author" content="Henri Funk"/>
<meta name="citation_author" content="Andreas Hofheinz"/>
<meta name="citation_author" content="Marius Girnat"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Event labeling combining ensemble detectors and background knowledge;citation_publication_date=2013;citation_publisher=Springer Berlin Heidelberg;citation_author=Hadi Fanaee-T;citation_author=Joao Gama"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","author","date","description","categories","bibliography","output","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Bike Sharing Demand - Use Case"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Henri Funk"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Andreas Hofheinz"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Marius Girnat"]}]}]},{"type":"character","attributes":{},"value":["07-27-2020"]},{"type":"character","attributes":{},"value":["This use case provides an example on tuning and benchmarking in mlr3verse using data from Capital Bikeshare."]},{"type":"character","attributes":{},"value":["tuning","benchmarking","nested resampling","filter","branching"]},{"type":"character","attributes":{},"value":["bs.bib"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","css"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["../../custom.css"]}]}]},{"type":"character","attributes":{},"value":["https://mlr3gallery.mlr-org.com/posts/2020-07-27-bikesharing-demand/"]},{"type":"character","attributes":{},"value":["https://mlr3gallery.mlr-org.com/posts/2020-07-27-bikesharing-demand/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["2020-07-27-bikesharing-demand_files/figure-html5/bbytime-1.png","2020-07-27-bikesharing-demand_files/figure-html5/corr-1.png","2020-07-27-bikesharing-demand_files/figure-html5/dense-1.png","2020-07-27-bikesharing-demand_files/figure-html5/grouped-1.png","2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-12-1.png","2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-13-1.png","2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-13-2.png","2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-14-1.png","2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-14-2.png","2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-16-1.png","2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-21-1.png","2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-26-1.png","2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-30-1.png","2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-34-1.png","2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-36-1.png","2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-47-1.png","2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-48-1.png","bmr.png","bs.bib"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

</style>

<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createIndex() {
  var options = {
    keys: [
      "title",
      "categories",
      "description",
      "contents"
    ]
  };
  return new window.Fuse([],options);
}

function createFuseIndex() {

  // create fuse index
  var options = { keys: ["title", "description", "contents"] };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
            keys: [
              { name: 'title', weight: 20 },
              { name: 'categories', weight: 15 },
              { name: 'description', weight: 10 },
              { name: 'contents', weight: 5 },
            ],
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
            .filter(function(item) { return !!item.description; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description}
                </div>
                <div class="search-item-preview">
                  <img src="${suggestion.preview ? offsetURL(suggestion.preview) : ''}"</img>
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: hidden;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="../../custom.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Bike Sharing Demand - Use Case","description":"This use case provides an example on tuning and benchmarking in mlr3verse using data from Capital Bikeshare.","authors":[{"author":"Henri Funk","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""},{"author":"Andreas Hofheinz","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""},{"author":"Marius Girnat","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2020-07-27T00:00:00.000+00:00","citationText":"Funk, et al., 2020"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="https://mlr3.mlr-org.com">
<img src="../../images/logo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">mlr3gallery</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="https://github.com/mlr-org/mlr3gallery">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Bike Sharing Demand - Use Case</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../index.html#category:tuning" class="dt-tag">tuning</a>
  <a href="../../index.html#category:benchmarking" class="dt-tag">benchmarking</a>
  <a href="../../index.html#category:nested_resampling" class="dt-tag">nested resampling</a>
  <a href="../../index.html#category:filter" class="dt-tag">filter</a>
  <a href="../../index.html#category:branching" class="dt-tag">branching</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>This use case provides an example on tuning and benchmarking in mlr3verse using data from Capital Bikeshare.</p></p>
</div>

<div class="d-byline">
  Henri Funk  
  
,   Andreas Hofheinz  
  
,   Marius Girnat  
  
<br/>07-27-2020
</div>

<div class="d-article">
<h1 id="preamble">Preamble</h1>
<p>The following examples were created as part of the Introduction to Machine Learning Lecture at LMU Munich. The goal of the project was to create and compare one or several machine learning pipelines for the problem at hand together with exploratory analysis and an exposition of results. The posts were contributed to the mlr3gallery by the authors and edited for better legibility by the editor. We want to thank the authors for allowing us to publish their results. Note, that correctness of the results can not be guaranteed.</p>
<h1 id="intro">Intro</h1>
<p>Bike sharing is a network of publicly shared bicycles that can be rented for a certain period of time at different locations within a city and then returned at any station. For the suppliers of those networks, it is important to always have enough bicycles available, whereby the demand depends on a variety of factors. Therefore it is essential to have a forecasting system that predicts the demand taking into account several variables. In this document, we develop such a system using the <code>mlr3verse</code> package. For our analysis, we used the <a href="https://www.kaggle.com/c/bike-sharing-demand/data">Kaggle Bike Sharing Demand</a> data set, which was provided by Hadi Fanaee Tork using data from Capital Bikeshare. <span class="citation" data-cites="Fanaee">(Fanaee-T and Gama <a href="#ref-Fanaee" role="doc-biblioref">2013</a>)</span> After ingesting the data into R we continue with some descriptive statistics for our training data set. We then preprocess the data and carry out feature and target engineering. Afterwards we proceed with the modeling process in which we fit, tune and benchmark the <em>KNN</em>, <em>CART</em> and <em>RandomForest</em> learner of the <code>mlr3verse</code> package. We conclude with our model prediction for the data.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>This tutorial assumes familiarity with the basics of <a href="https://mlr3tuning.mlr-org.com">mlr3tuning</a> and <a href="https://mlr3pipelines.mlr-org.com">mlr3pipelines</a>. Consult the <a href="https://mlr3book.mlr-org.com/pipelines.html">mlr3book</a> if some aspects are not fully understandable.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'># rmd</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://yihui.org/knitr/'>knitr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://haozhu233.github.io/kableExtra/'>kableExtra</a></span><span class='op'>)</span>
<span class='co'># descriptive</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://boxuancui.github.io/DataExplorer/'>DataExplorer</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggobi.github.io/ggally'>GGally</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://github.com/slowkow/ggrepel'>ggrepel</a></span><span class='op'>)</span>
<span class='co'># tools</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://lubridate.tidyverse.org'>lubridate</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyr.tidyverse.org'>tidyr</a></span><span class='op'>)</span>
<span class='co'># analytic</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://mlr3verse.mlr-org.com'>mlr3verse</a></span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Note, that expensive calculations are pre-saved in rds files in this tutorial to save computational time. <!--
To recheck the code is still up to date and syntax sticks to the current mlr3 version initialize `long_run = TRUE`.
This will run *all* code chunks no matter the computational effort.
--></p>
<h1 id="data">Data</h1>
<p>Note that we use the data from <a href="http://archive.ics.uci.edu/ml/datasets/Bike+Sharing+Dataset">UCI Machinelearning Repository</a> here instead of the Kaggle data set due to License restrictions. The UCI dataset is a slightly adjusted version of the same underlying data.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 id="ingestion">Ingestion</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>train_datetime</span> <span class='op'>=</span> <span class='va'>train</span><span class='op'>$</span><span class='va'>datetime</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>The Bike Sharing Demand data set contains 10886 rows and 12 columns.</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="">
<caption>
<span id="tab:tw">Table 1: </span>Column description training data
</caption>
<thead>
<tr>
<th style="text-align:left;">
Column Name
</th>
<th style="text-align:left;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
datetime
</td>
<td style="text-align:left;">
hourly date
</td>
</tr>
<tr>
<td style="text-align:left;">
season
</td>
<td style="text-align:left;">
<span class="math display">\[\begin{cases} 
              1, \ spring \\ 
              2, \ summer \\ 
              3, \ fall \\ 
              4, \ winter \\ 
            \end{cases}\]</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
holiday
</td>
<td style="text-align:left;">
<span class="math display">\[\begin{cases} 
              1, \ holiday \\ 
              0, \ else \\ 
            \end{cases}\]</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
workingday
</td>
<td style="text-align:left;">
<span class="math display">\[\begin{cases} 
              1, \ neither \ weekend \ nor \ holiday \\ 
              0, \ else \\ 
            \end{cases}\]</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
weather
</td>
<td style="text-align:left;">
<span class="math display">\[\begin{cases}
              1, \ Clear, \ Few \ clouds\\ 
              2, \ Mist \ and \ Cloudy\\ 
              3, \ Light \ Snow, \ Light \ Rain, \ Thunderstorm\\ 
              4, \ Heavy \ Rain, \ Ice \ Pallets\\ 
          \end{cases}\]</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
temp
</td>
<td style="text-align:left;">
temperature in Celsius
</td>
</tr>
<tr>
<td style="text-align:left;">
atemp
</td>
<td style="text-align:left;">
‘feels like’ temperature in Celsius
</td>
</tr>
<tr>
<td style="text-align:left;">
humidity
</td>
<td style="text-align:left;">
relative humidity
</td>
</tr>
<tr>
<td style="text-align:left;">
windspeed
</td>
<td style="text-align:left;">
wind speed
</td>
</tr>
<tr>
<td style="text-align:left;">
casual
</td>
<td style="text-align:left;">
number of non-registered user rentals initiated
</td>
</tr>
<tr>
<td style="text-align:left;">
registered
</td>
<td style="text-align:left;">
number of registered user rentals initiated
</td>
</tr>
<tr>
<td style="text-align:left;">
count
</td>
<td style="text-align:left;">
number of total rentals
</td>
</tr>
</tbody>
</table>
</div>
<p>Table 1 gives a detailed overview of the columns of our training data set. Besides our target variable <code>count</code>, we have several weather related variables we can use for our prediction. Moreover, we have the date and hour of the observation as well as holiday and workingday indicators. Since there are no missing values in our data, we do not need to apply any further imputation methods.</p>
<h2 id="descriptive-statistics">Descriptive Statistics</h2>
<p>In Figure 1 we show the density estimates of the continuous variables in the training data. We find that our target variable <code>count</code> is highly right-skewed, which we examine further during pre-processing in chapter 2.3.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:dense"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/dense-1.png" alt="Density estimates of the continuous variables in training data" width="624" />
<p class="caption">
Figure 1: Density estimates of the continuous variables in training data
</p>
</div>
</div>
<p>The correlation of the continuous variables of our training data is shown in Figure 2. We find that there is an almost perfect positive correlation between <code>atemp</code> and <code>temp</code> (<span class="math inline">\(r = 0.98\)</span>), swhich makes sense, since the ‘feels like’ temperature is very similar to the real temperature. Moreover, there is a positive correlation between <code>count</code> and <code>atemp</code> as well as <code>count</code> and <code>temp</code> (<span class="math inline">\(r = 0.39\)</span>). Additionally, we see that our target variable <code>count</code> is negatively correlated with the <code>humidity</code> (<span class="math inline">\(r = - 0.32\)</span>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:corr"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/corr-1.png" alt="Correlation matrix of continuous variables in training data" width="624" />
<p class="caption">
Figure 2: Correlation matrix of continuous variables in training data
</p>
</div>
</div>
<p>Figure 3 shows the Bike Sharing demand over the entire time frame of our training data. We find an overall positive trend with seasonality, whereby the demand is higher in summer than in winter.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:bbytime"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/bbytime-1.png" alt="Bike Sharing demand over time" width="624" />
<p class="caption">
Figure 3: Bike Sharing demand over time
</p>
</div>
</div>
<p>As we can see in Figure 4, the bike sharing demand is fairly evenly distributed over a month. Note that we have no values for days after the 19th day of each month in our training data since those days are included in our test data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:grouped"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/grouped-1.png" alt="Distribution of Bike Sharing demand over a month" width="624" />
<p class="caption">
Figure 4: Distribution of Bike Sharing demand over a month
</p>
</div>
</div>
<h2 id="preprocessing">Preprocessing</h2>
<p>It applies that <code>count == casual + registered</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/all.equal.data.table.html'>all.equal</a></span><span class='op'>(</span><span class='va'>train</span><span class='op'>$</span><span class='va'>count</span>, <span class='va'>train</span><span class='op'>$</span><span class='va'>casual</span> <span class='op'>+</span> <span class='va'>train</span><span class='op'>$</span><span class='va'>registered</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
</div>
<p>So we cannot use <code>casual</code> and <code>registered</code> as features to predict <code>count</code> since we only know them once we also know <code>count</code>. Therefore we can remove them without affecting the prediction quality. Furthermore the features <code>atem</code> the ‘feels like’ temperature and <code>temp</code> the real temperature have a nearly perfect correlation.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='va'>train</span><span class='op'>$</span><span class='va'>atem</span>, <span class='va'>train</span><span class='op'>$</span><span class='va'>temp</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.9849481</code></pre>
</div>
<p>Therefore we omit <code>temp</code> feature during the modeling process to reduce the number of features and the complexity of our data structure. Additionally, we convert nominal and ordinal features to factors and <code>datetime</code> to POSIXct. The structure of our pre-processed data is shown in Table 3.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>train</span> <span class='op'>=</span> <span class='fu'>preprocess</span><span class='op'>(</span><span class='va'>train</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-8">Table 2: </span>Processed training data
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:left;">
Class
</th>
<th style="text-align:left;">
Mode
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
atemp
</td>
<td style="text-align:left;">
-none-
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
count
</td>
<td style="text-align:left;">
-none-
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
datetime
</td>
<td style="text-align:left;">
POSIXct
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
holiday
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
humidity
</td>
<td style="text-align:left;">
-none-
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
season
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
weather
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
windspeed
</td>
<td style="text-align:left;">
-none-
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
workingday
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
</tbody>
</table>
</div>
<h2 id="feature-engineering">Feature engineering</h2>
<p>Since we have one observation at each time, each time stamp (<code>datetime</code>) is a unique value and therefore has no predictive quality. However, if we split it into <code>hour</code>, <code>weekday</code>, <code>month</code> and <code>year</code> we obtain useful predictors. The structure of our pre-processed training data is visualized in Table 4.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Note, that <a href="https://github.com/mlr-org/mlr3pipelines/blob/master/R/PipeOpDateFeatures.R">PipeOpDateFeatures</a> provides an alternative to engineering such features by automatically extracting a set of date-related features from a <code>POSIXct</code> date variable. <strong>Note</strong>: In this scenario, we assume that we are not interested in forecasting the demand for the following years (provided the other information), but we instead try to obtain a model that describes the existing data as well as possible. In a forecasting scenario, we would need to use a different time-sensitvie resampling strategy in order to assure that our model generalizes to the data we are interested in predicting (the future).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>train</span> <span class='op'>=</span> <span class='fu'>engineer_features</span><span class='op'>(</span><span class='va'>train</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-11">Table 3: </span>Feature engineered training data
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:left;">
Class
</th>
<th style="text-align:left;">
Mode
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
atemp
</td>
<td style="text-align:left;">
-none-
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
count
</td>
<td style="text-align:left;">
-none-
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
holiday
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
hour
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
humidity
</td>
<td style="text-align:left;">
-none-
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
month
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
season
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
weather
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
weekday
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
windspeed
</td>
<td style="text-align:left;">
-none-
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
workingday
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
<tr>
<td style="text-align:left;">
year
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
numeric
</td>
</tr>
</tbody>
</table>
</div>
<p>In Figure 6 we use our engineered <code>hour</code> variable to plot the Bike Sharing demand by hour and temperature. Note, that the felt temperature <code>atemp</code> is normalized. We find that the highest demand occurs between 18h and 20h at higher temperatures.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:unnamed-chunk-12"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-12-1.png" alt="Bike Sharing demand by hour and temperature" width="624" />
<p class="caption">
Figure 5: Bike Sharing demand by hour and temperature
</p>
</div>
</div>
<h2 id="target-engineering">Target engineering</h2>
<p>As mentioned in our descriptive analysis (chapter 2.2), we find that our target variable <code>count</code> is highly right-skewed. Since this could cause problems during model fitting, we perform a <span class="math inline">\(z = log(x + 1)\)</span> transformation. In the right plot in Figure 6, we see that the distribution of our transformed <code>count</code> variable is much less skewed than before.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:unnamed-chunk-13"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-13-1.png" alt="Density transformation of `count`" width="50%" /><img src="2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-13-2.png" alt="Density transformation of `count`" width="50%" />
<p class="caption">
Figure 6: Density transformation of <code>count</code>
</p>
</div>
</div>
<p>For predictions we have to transform it back to the original scale with <span class="math inline">\(x = exp(z) - 1\)</span>.<br />
(Note that <span class="math inline">\(exp(log(x + 1)) - 1 = x\)</span>) mlr3 simplifies this process by offering Pipeline Operators (PipeOps for short). These <code>PipeOps</code> are computational steps that can be arranged into Pipelines to manage data flow in mlr3.</p>
<p>Using <code>PipeOpTargetTrafo</code> we can dynamically transform our target before the prediction and transform it back into our original scale afterwards.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>log1p_target_trafo</span> <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>learner</span>, <span class='va'>graph</span> <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>ppl</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3pipelines.mlr-org.com//reference/ppl.html'>ppl</a></span><span class='op'>(</span><span class='st'>"targettrafo"</span>, graph <span class='op'>=</span> <span class='va'>learner</span><span class='op'>)</span>
  <span class='va'>ppl</span><span class='op'>$</span><span class='va'>param_set</span><span class='op'>$</span><span class='va'>values</span><span class='op'>$</span><span class='va'>targettrafosimple.trafo</span> <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log1p</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
  <span class='va'>ppl</span><span class='op'>$</span><span class='va'>param_set</span><span class='op'>$</span><span class='va'>values</span><span class='op'>$</span><span class='va'>targettrafosimple.inverter</span> <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>expm1</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>graph</span> <span class='op'>==</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'><a href='https://mlr3pipelines.mlr-org.com//reference/mlr_learners_graph.html'>GraphLearner</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='va'>ppl</span>, task_type <span class='op'>=</span> <span class='st'>"regr"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>ppl</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<h1 id="modelling">Modelling</h1>
<h2 id="task-initialization">Task Initialization</h2>
<p>First, we have to initialize our bike task. As back-end, we use our training data and as target variable <code>count</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>bike_task</span> <span class='op'>=</span> <span class='va'><a href='https://mlr3.mlr-org.com/reference/TaskRegr.html'>TaskRegr</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='st'>"bike_sharing"</span>, backend <span class='op'>=</span> <span class='va'>train</span>, target <span class='op'>=</span> <span class='st'>"count"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="descriptive-analysis-with-mlr3">Descriptive Analysis with <code>mlr3</code></h2>
<p>The <code>mlr3viz</code> package enables the user to quickly create insightful descriptive graphics. We use this function to compare the values of our target variable <code>count</code> over the seasons and between holidays and other days. The results are visualized in Figure 7. We notice that there is almost no difference between the seasons with the exception of spring when the value of <code>count</code> is lower. Moreover, there is no real change between holidays and other days.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:unnamed-chunk-14"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-14-1.png" alt="Autoplot season/holiday" width="50%" /><img src="2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-14-2.png" alt="Autoplot season/holiday" width="50%" />
<p class="caption">
Figure 7: Autoplot season/holiday
</p>
</div>
</div>
<p>To examine relationships between variables in train data, we can also use the <code>autoplot</code> function and set the <code>type</code> argument to “pairs”. We make use of this option to further investigate the relationship between <code>atemp</code>, <code>windspeed</code> and <code>count</code> and compare it over the two years of our data. The result is visualized in Figure 8. In the upper left graph, we notice that there the value of <code>log1p_count</code> is higher in 2012 than in 2011. In contrast, the distribtions of <code>atemp</code> and <code>windspeed</code> do not seem to differ between the years. Also, the correlations of the variables are fairly similar in both years.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:unnamed-chunk-16"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-16-1.png" alt="Relationship between atemp, windspeed and count by year" width="624" />
<p class="caption">
Figure 8: Relationship between atemp, windspeed and count by year
</p>
</div>
</div>
<h2 id="model-training">Model training</h2>
<p>In our modeling process, we consider three learners: <code>kknn</code>, <code>rpart</code> and <code>ranger</code>. For parameter optimization, we use the so-called <code>autotuner</code>. An <code>Autotuner</code> is a learner, that tunes its hyperparameters during training. The technical implementation is provided by <code>mlr3tuning</code>. For more details see the <a href="https://mlr3book.mlr-org.com/tuning.html">mlr3manual</a>.</p>
<p>In order to achieve maximum comparability between the learners the <code>Resampling</code> objects and which enable us to measure a learner-configuration’s performance as well as the tuning strategy are kept fixed for all compared learners. If a learner’s settings differ from the general case, the reason is given in the section on the <code>autotuner</code> concerned.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>resampling_cv_5</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>rsmp</a></span><span class='op'>(</span><span class='st'>"cv"</span>, folds <span class='op'>=</span> <span class='fl'>5L</span><span class='op'>)</span>
<span class='va'>resampling_outer_cv3</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>rsmp</a></span><span class='op'>(</span><span class='st'>"cv"</span>, folds <span class='op'>=</span> <span class='fl'>3L</span><span class='op'>)</span>
<span class='va'>measures</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>msr</a></span><span class='op'>(</span><span class='st'>"regr.rmse"</span><span class='op'>)</span>
<span class='va'>tuner_grid_10</span> <span class='op'>=</span> <span class='fu'>mlr3tuning</span><span class='fu'>::</span><span class='fu'><a href='https://mlr3tuning.mlr-org.com/reference/tnr.html'>tnr</a></span><span class='op'>(</span><span class='st'>"grid_search"</span>, resolution <span class='op'>=</span> <span class='fl'>10L</span><span class='op'>)</span>
<span class='va'>term_evals20</span> <span class='op'>=</span> <span class='fu'><a href='https://bbotk.mlr-org.com/reference/trm.html'>trm</a></span><span class='op'>(</span><span class='st'>"evals"</span>, n_evals <span class='op'>=</span> <span class='fl'>20L</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li><p><code>nested resampling</code> is a method to obtain an unbiased performance estimation for each learner. For more information see <a href="https://mlr3book.mlr-org.com/nested-resampling.html">Nested Resamling</a>. During our modeling process, we use 5-fold CV for <code>inner resampling</code> to avoid overfitting when optimizing the model parameters (<code>resampling_cv_5</code>). In order to avoid overfitting during hyperparameter tuning, we use 3-fold CV as <code>outer resampling</code> method (<code>resampling_outer_cv3</code>). Nested resampling is done in our Chapter 5 “Nested Resampling” where we evaluate and compare the performance of the learners in a single Graph Learner.</p></li>
<li><p><code>measure</code> defines the loss function that the autotuner evaluates during training. As the Kaggle competition requires participants to minimize the <code>RMSLE</code> we use the <code>RMSE measure</code> since our target variable is already log-transformed.</p></li>
<li><p><code>tuning method</code> will be Grid Search with a grid resolution of 10. As we chose two hyperparameters to tune over, the two-dimensional grid consists of <span class="math inline">\(10^{2} = 100\)</span> configurations. The tuner grid is called <code>tuner_grid_10</code>.</p></li>
<li><p><code>terminator</code> limits the tuning process to 20 hyperparameter combinations, which will be drawn randomly from the <code>tuner_grid_10</code>. The terminator is called <code>term_evals20</code>.</p></li>
</ul>
<p>As the computational time of <code>nested resampling</code> is high and tuning over multiple parameters would be very complex, the <code>autotuners</code> are be restricted to two hyperparameters, that seem to have a strong influence on the <code>regr.rmse</code>. The hyperparameter space of numeric hyperparameter is set around their default values for tuning.</p>
<p>Resampling and Terminator during auto tuning are set to relatively small iterations to save up computational effort. In regular cases we would suggest using 5- or 10-fold crossvalidiation. Auto tuning should exploit enough grid points to give the user an impression about the whole hyperparameter space.</p>
<h3 id="knn">KNN</h3>
<p><code>kknn</code> is a k-nearest-neighbor learner whose hyperparameters are shown in Table 5.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>kknn_learner</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>lrn</a></span><span class='op'>(</span><span class='st'>"regr.kknn"</span><span class='op'>)</span>
<span class='va'>kknn_learner</span><span class='op'>$</span><span class='va'>param_set</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-18">Table 4: </span>Paramters of kknn learner
</caption>
<thead>
<tr>
<th style="text-align:left;">
id
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
<th style="text-align:left;">
levels
</th>
<th style="text-align:left;">
default
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 2cm; ">
k
</td>
<td style="text-align:right;width: 1.5cm; ">
1
</td>
<td style="text-align:right;width: 1.5cm; ">
Inf
</td>
<td style="text-align:left;width: 8cm; ">
NULL
</td>
<td style="text-align:left;">
7
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
distance
</td>
<td style="text-align:right;width: 1.5cm; ">
0
</td>
<td style="text-align:right;width: 1.5cm; ">
Inf
</td>
<td style="text-align:left;width: 8cm; ">
NULL
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
kernel
</td>
<td style="text-align:right;width: 1.5cm; ">
NA
</td>
<td style="text-align:right;width: 1.5cm; ">
NA
</td>
<td style="text-align:left;width: 8cm; ">
rectangular , triangular , epanechnikov, biweight , triweight , cos , inv , gaussian , rank , optimal
</td>
<td style="text-align:left;">
optimal
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
scale
</td>
<td style="text-align:right;width: 1.5cm; ">
NA
</td>
<td style="text-align:right;width: 1.5cm; ">
NA
</td>
<td style="text-align:left;width: 8cm; ">
TRUE, FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
ykernel
</td>
<td style="text-align:right;width: 1.5cm; ">
NA
</td>
<td style="text-align:right;width: 1.5cm; ">
NA
</td>
<td style="text-align:left;width: 8cm; ">
NULL
</td>
<td style="text-align:left;">
NULL
</td>
</tr>
</tbody>
</table>
</div>
<p>For simplicity we tune only two of those parameters:</p>
<ol type="1">
<li><p><code>k</code><br />
&gt; Number of neighbors considered.</p></li>
<li><p><code>distance</code><br />
&gt; Parameter of Minkowski distance</p></li>
</ol>
<p>For more information see the <a href="https://cran.r-project.org/web/packages/kknn/kknn.pdf">kknn documentation</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>param_set_kknn</span> <span class='op'>=</span> <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamSet.html'>ParamSet</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span>
  params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamInt.html'>ParamInt</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='st'>"regr.kknn.k"</span>, lower <span class='op'>=</span> <span class='fl'>1L</span>, upper <span class='op'>=</span> <span class='fl'>50L</span><span class='op'>)</span>, <span class='co'># k</span>
    <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamInt.html'>ParamInt</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='st'>"regr.kknn.distance"</span>, lower <span class='op'>=</span> <span class='fl'>1L</span>, upper <span class='op'>=</span> <span class='fl'>3L</span><span class='op'>)</span> <span class='co'># distance</span>
  <span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now we set up the autotuner for the <code>kknn</code> learner and train it.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123456</span><span class='op'>)</span>
<span class='va'>ppl_kknn</span> <span class='op'>=</span> <span class='fu'>log1p_target_trafo</span><span class='op'>(</span><span class='va'>kknn_learner</span><span class='op'>)</span>
<span class='va'>at_kknn</span> <span class='op'>=</span> <span class='va'><a href='https://mlr3tuning.mlr-org.com/reference/AutoTuner.html'>AutoTuner</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='va'>ppl_kknn</span>,
  resampling <span class='op'>=</span> <span class='va'>resampling_cv_5</span>,
  measure <span class='op'>=</span> <span class='va'>measures</span>,
  search_space <span class='op'>=</span> <span class='va'>param_set_kknn</span>,
  terminator <span class='op'>=</span> <span class='va'>term_evals20</span>,
  tuner <span class='op'>=</span> <span class='va'>tuner_grid_10</span>
<span class='op'>)</span>

<span class='va'>at_kknn</span><span class='op'>$</span><span class='fu'>train</span><span class='op'>(</span><span class='va'>bike_task</span><span class='op'>)</span>


<span class='va'>archive_kknn</span> <span class='op'>=</span> <span class='va'>at_kknn</span><span class='op'>$</span><span class='va'>archive</span><span class='op'>$</span><span class='fu'>data</span><span class='op'>(</span><span class='op'>)</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"regr.rmse"</span>,
                                          <span class='st'>"regr.kknn.k"</span>,
                                          <span class='st'>"regr.kknn.distance"</span><span class='op'>)</span><span class='op'>]</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>In Figure 9 we see the RMSE for the considered hyperparameter of the <code>kknn</code> autotuner. It seems that a higher order <code>p</code> of the Minkowski distance leads to a lower <code>RMSE</code>. Moreover, we see that the <code>RMSE</code> is lowest around <code>k = 10</code> neighbors. For smaller <code>k</code> the estimation might be too wiggly, for higher <code>k</code> it might be too global (Bias-Variance trade off). The minimal RMSE that the <code>autotuner</code> could find is given for <code>p = 3</code> and <code>k = 12</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:unnamed-chunk-21"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-21-1.png" alt="RMSE on tuning grid of kknn autotuner" width="624" />
<p class="caption">
Figure 9: RMSE on tuning grid of kknn autotuner
</p>
</div>
</div>
<h3 id="cart">CART</h3>
<p><code>rpart</code> is CART learner whose hyperparameters are shown in Table 6.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>rpart_learner</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>lrn</a></span><span class='op'>(</span><span class='st'>"regr.rpart"</span><span class='op'>)</span>
<span class='va'>rpart_learner</span><span class='op'>$</span><span class='va'>param_set</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-23">Table 5: </span>Paramters of rpart learner
</caption>
<thead>
<tr>
<th style="text-align:left;">
id
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
<th style="text-align:left;">
levels
</th>
<th style="text-align:left;">
default
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
minsplit
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
Inf
</td>
<td style="text-align:left;">
NULL
</td>
<td style="text-align:left;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
minbucket
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
Inf
</td>
<td style="text-align:left;">
NULL
</td>
<td style="text-align:left;">
&lt;environment: 0x55dadf22b908&gt;
</td>
</tr>
<tr>
<td style="text-align:left;">
cp
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
NULL
</td>
<td style="text-align:left;">
0.01
</td>
</tr>
<tr>
<td style="text-align:left;">
maxcompete
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
Inf
</td>
<td style="text-align:left;">
NULL
</td>
<td style="text-align:left;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
maxsurrogate
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
Inf
</td>
<td style="text-align:left;">
NULL
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
maxdepth
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
NULL
</td>
<td style="text-align:left;">
30
</td>
</tr>
<tr>
<td style="text-align:left;">
usesurrogate
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
NULL
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
surrogatestyle
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
NULL
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
xval
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
Inf
</td>
<td style="text-align:left;">
NULL
</td>
<td style="text-align:left;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
keep_model
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
TRUE, FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
</tbody>
</table>
</div>
<p>Again, for simplicity, we tune only two of those parameters:</p>
<ol type="1">
<li><p><code>minsplit</code><br />
&gt; the minimum number of observations that must exist in a node in order for a split to be attempted.</p></li>
<li><p><code>cp</code><br />
&gt; complexity parameter. Any split that does not decrease the overall lack of fit by a factor of cp is not attempted. […]</p></li>
</ol>
<p>For more information browse the <a href="https://cran.r-project.org/web/packages/rpart/rpart.pdf">rpart Documentation</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>param_set_cart</span> <span class='op'>=</span> <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamSet.html'>ParamSet</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span>
  params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamInt.html'>ParamInt</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='st'>"regr.rpart.minsplit"</span>, lower <span class='op'>=</span> <span class='fl'>1L</span>, upper <span class='op'>=</span> <span class='fl'>30L</span><span class='op'>)</span>,
    <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamDbl.html'>ParamDbl</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='st'>"regr.rpart.cp"</span>, lower <span class='op'>=</span> <span class='fl'>0.001</span>, upper <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now we set up the autotuner for the <code>rpart</code> learner and train it.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123456</span><span class='op'>)</span>
<span class='va'>ppl_rpart</span> <span class='op'>=</span> <span class='fu'>log1p_target_trafo</span><span class='op'>(</span><span class='va'>rpart_learner</span><span class='op'>)</span>
<span class='va'>at_rpart</span> <span class='op'>=</span> <span class='va'><a href='https://mlr3tuning.mlr-org.com/reference/AutoTuner.html'>AutoTuner</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='va'>ppl_rpart</span>,
  resampling <span class='op'>=</span> <span class='va'>resampling_cv_5</span>,
  measure <span class='op'>=</span> <span class='va'>measures</span>,
  search_space <span class='op'>=</span> <span class='va'>param_set_cart</span>,
  terminator <span class='op'>=</span> <span class='va'>term_evals20</span>,
  tuner <span class='op'>=</span> <span class='va'>tuner_grid_10</span>
<span class='op'>)</span>
<span class='va'>at_rpart</span><span class='op'>$</span><span class='fu'>train</span><span class='op'>(</span><span class='va'>bike_task</span><span class='op'>)</span>
<span class='va'>archive_rpart</span> <span class='op'>=</span> <span class='va'>at_rpart</span><span class='op'>$</span><span class='va'>archive</span><span class='op'>$</span><span class='fu'>data</span><span class='op'>(</span><span class='op'>)</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"regr.rmse"</span>,
                                            <span class='st'>"regr.rpart.minsplit"</span>,
                                            <span class='st'>"regr.rpart.cp"</span><span class='op'>)</span><span class='op'>]</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>In Figure 10 we see the RMSE for the considered hyperparameter of the <code>rpart</code> autotuner. The learner performs the worst if we set the minimum size of nodes in <code>minsplit &lt; 3</code>. For splitting criteria <code>minsplit &gt; 3</code> seems to have no significant influence on the RMSE in the given hyperparameter space. In contrast, we find that for relatively low <code>cp</code> the error decreases considerably. Lowering <code>cp</code> reduces the level of pruning, resulting in larger trees. We reach the minimal <code>regr.rmse</code> at the lowest considered <code>cp = 0.001</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:unnamed-chunk-26"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-26-1.png" alt="RMSE on tuning grid rpart learner" width="624" />
<p class="caption">
Figure 10: RMSE on tuning grid rpart learner
</p>
</div>
</div>
<h3 id="random-forest">Random Forest</h3>
<p><code>ranger</code> is a Random Forest Learner whose hyperparameters are shown in Table 7.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>ranger_learner</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>lrn</a></span><span class='op'>(</span><span class='st'>"regr.ranger"</span>, importance <span class='op'>=</span> <span class='st'>"impurity"</span><span class='op'>)</span>
<span class='va'>ranger_learner</span><span class='op'>$</span><span class='va'>param_set</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-28">Table 6: </span>Paramters of ranger learner
</caption>
<thead>
<tr>
<th style="text-align:left;">
id
</th>
<th style="text-align:left;">
levels
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
num.trees
</td>
<td style="text-align:left;">
NULL
</td>
</tr>
<tr>
<td style="text-align:left;">
mtry
</td>
<td style="text-align:left;">
NULL
</td>
</tr>
<tr>
<td style="text-align:left;">
importance
</td>
<td style="text-align:left;">
none , impurity , impurity_corrected, permutation
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:left;">
quantreg
</td>
<td style="text-align:left;">
TRUE, FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
predict.all
</td>
<td style="text-align:left;">
TRUE, FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
se.method
</td>
<td style="text-align:left;">
jack , infjack
</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Feature Importance</strong></p>
<p>First, we take advantage of the ability of the <code>ranger_learner</code> to calculate the importance of its features. The <code>importance filter</code> implemented in <code>mlr3filters</code> provides the possibility to access this calculation via <code>mlr3</code> syntax.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>filter_ranger</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3filters.mlr-org.com/reference/flt.html'>flt</a></span><span class='op'>(</span><span class='st'>"importance"</span>, learner <span class='op'>=</span> <span class='va'>ranger_learner</span><span class='op'>)</span>
<span class='va'>filter_ranger</span><span class='op'>$</span><span class='fu'>calculate</span><span class='op'>(</span><span class='va'>bike_task</span><span class='op'>)</span>
<span class='va'>feature_importance</span> <span class='op'>=</span> <span class='fu'><a href='https://paradox.mlr-org.com/reference/as.data.table.html'>as.data.table</a></span><span class='op'>(</span><span class='va'>filter_ranger</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>In Figure 11 we see there is a difference in features. Some features don’t seem to make a contribution to the model performance that is worthwhile to implement to the learner’s architecture. To test this hypothesis we are going to set up a learner that can test different feature combinations.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:unnamed-chunk-30"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-30-1.png" alt="Feature importance in ranger learner" width="624" />
<p class="caption">
Figure 11: Feature importance in ranger learner
</p>
</div>
</div>
<p>We use the features in decreasing order of feature importance. Say, if we use <span class="math inline">\(n\)</span> features to predict the target we use the <span class="math inline">\(n\)</span> most important features according to their <code>impurity</code>. Therefore, we set up a graph learner in the next step.</p>
<p><strong>Ranger Pipe</strong></p>
<p>Setting up the Ranger Pipe enables us to compare models with different feature combinations. Therefore we use the <code>mlr3</code> packages <code>mlr3pipelines</code> and <code>mlr3filters</code> and create a new learner <code>ranger_feature</code>. This learner is now able to select the most important features from the impurity filtering.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>po_flt</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3pipelines.mlr-org.com//reference/po.html'>po</a></span><span class='op'>(</span><span class='st'>"filter"</span>, <span class='va'>filter_ranger</span>, param_vals <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>filter.nfeat <span class='op'>=</span> <span class='fl'>11L</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;&gt;%</span>
  <span class='fu'><a href='https://mlr3pipelines.mlr-org.com//reference/po.html'>po</a></span><span class='op'>(</span><span class='st'>"learner"</span>, <span class='va'>ranger_learner</span><span class='op'>$</span><span class='fu'>clone</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p><strong>Tuning Random Forest</strong></p>
<p>In addition to the regular <code>ranger</code> features, we are now able to tune on any parameter from the importance <code>PipeOp</code>.</p>
<p>Again, for simplicity, we tune only two of those parameters:</p>
<ol type="1">
<li><p><code>regr.ranger.mtry</code><br />
&gt; Number of variables to possibly split at in each node. Default is the (rounded down) square root of the number variables. […]</p></li>
<li><p><code>importance.filter.nfeat</code><br />
&gt; A param from <code>importance</code> that allows to control the size of features computed in the model.</p></li>
</ol>
<p>For more information see the <a href="https://cran.r-project.org/web/packages/ranger/ranger.pdf">ranger documentation</a> and <a href="https://mlr3book.mlr-org.com/pipelines.html">mlr3 pipelines</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>param_set_ranger</span> <span class='op'>=</span> <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamSet.html'>ParamSet</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span>
  params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamInt.html'>ParamInt</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='st'>"regr.ranger.mtry"</span>, lower <span class='op'>=</span> <span class='fl'>1L</span>, upper <span class='op'>=</span> <span class='fl'>11L</span><span class='op'>)</span>,
    <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamInt.html'>ParamInt</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='st'>"importance.filter.nfeat"</span>, lower <span class='op'>=</span> <span class='fl'>1L</span>, upper <span class='op'>=</span> <span class='fl'>11L</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>To ensure that <code>regr.ranger.mtry</code> never exceeds <code>importance.filter.nfeat</code>, we define the search space for the tuner manually. We constraint the possible number of features to the 1, 6 , 10 and 11 most important feature(s). The resulting grid shown in Figure 12, expands to over 28 combinations to tune our learner on.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>grid</span> <span class='op'>=</span> <span class='fu'><a href='https://paradox.mlr-org.com/reference/generate_design_grid.html'>generate_design_grid</a></span><span class='op'>(</span><span class='va'>param_set_ranger</span>, resolution <span class='op'>=</span> <span class='fl'>11</span><span class='op'>)</span>
<span class='va'>grid</span><span class='op'>$</span><span class='va'>data</span> <span class='op'>=</span> <span class='va'>grid</span><span class='op'>$</span><span class='va'>data</span><span class='op'>[</span><span class='va'>regr.ranger.mtry</span> <span class='op'>&lt;=</span> <span class='va'>importance.filter.nfeat</span><span class='op'>]</span>
<span class='va'>grid</span><span class='op'>$</span><span class='va'>data</span> <span class='op'>=</span> <span class='va'>grid</span><span class='op'>$</span><span class='va'>data</span><span class='op'>[</span><span class='va'>importance.filter.nfeat</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>6</span>, <span class='fl'>10</span>, <span class='fl'>11</span><span class='op'>)</span><span class='op'>]</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:unnamed-chunk-34"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-34-1.png" alt="Search space for ranger autotuner" width="624" />
<p class="caption">
Figure 12: Search space for ranger autotuner
</p>
</div>
</div>
<p>To ensure that <code>regr.ranger.mtry</code> never exceeds, <code>importance.filter.nfeat</code> we define a search space. Since the space for hyperparameters is limited, one could consider here to exploit the whole parameter space for <code>nfeat</code> and <code>mtry</code>. To save up time we will stick to 28 combinations here, including all possible combinations at 1, 6, 10 and 11 levels.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123456</span><span class='op'>)</span>
<span class='va'>ranger_feature</span> <span class='op'>=</span> <span class='fu'>log1p_target_trafo</span><span class='op'>(</span><span class='va'>po_flt</span><span class='op'>)</span>
<span class='va'>at_ranger</span> <span class='op'>=</span> <span class='va'><a href='https://mlr3tuning.mlr-org.com/reference/AutoTuner.html'>AutoTuner</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='va'>ranger_feature</span>,
  resampling <span class='op'>=</span> <span class='va'>resampling_cv_5</span>,
  measure <span class='op'>=</span> <span class='va'>measures</span>,
  search_space <span class='op'>=</span> <span class='va'>param_set_ranger</span>,
  terminator <span class='op'>=</span> <span class='fu'><a href='https://bbotk.mlr-org.com/reference/trm.html'>trm</a></span><span class='op'>(</span><span class='st'>"evals"</span>, n_evals <span class='op'>=</span> <span class='fl'>28L</span><span class='op'>)</span>,
  tuner <span class='op'>=</span> <span class='fu'>mlr3tuning</span><span class='fu'>::</span><span class='fu'><a href='https://mlr3tuning.mlr-org.com/reference/tnr.html'>tnr</a></span><span class='op'>(</span><span class='st'>"design_points"</span>, design <span class='op'>=</span> <span class='va'>grid</span><span class='op'>$</span><span class='va'>data</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='co'># at_ranger$store_tuning_instance = FALSE</span>
<span class='va'>at_ranger</span><span class='op'>$</span><span class='fu'>train</span><span class='op'>(</span><span class='va'>bike_task</span><span class='op'>)</span>

<span class='va'>archive_ranger</span> <span class='op'>=</span> <span class='va'>at_ranger</span><span class='op'>$</span><span class='va'>archive</span><span class='op'>$</span><span class='fu'>data</span><span class='op'>(</span><span class='op'>)</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"regr.rmse"</span>,
                                              <span class='st'>"importance.filter.nfeat"</span>,
                                              <span class='st'>"regr.ranger.mtry"</span><span class='op'>)</span><span class='op'>]</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>In Figure 13 we see the RMSE for the evaluated hyperparameter of the ranger autotuner. With increasing <code>mtry</code> and the number <code>features</code> used in the model, the RMSE decreases. The best considered combination is achieved with 11 <code>features</code> and <code>mtry = 10</code>. For higher values of <code>mtry</code> and number of features <code>features</code> the <code>RMSE</code> is slightly higher.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:unnamed-chunk-36"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-36-1.png" alt="RMSE on tuning grid ranger learner" width="624" />
<p class="caption">
Figure 13: RMSE on tuning grid ranger learner
</p>
</div>
</div>
<h1 id="benchmarking">Benchmarking</h1>
<p>Benchmarking has two objectives. First, we want to obtain a performance measure for all the fitted models through resampling.</p>
<p>Second, we want to compare the models with each other and examine how tuning improved each of them. As stated in Chapter 3.3 we use a 3-fold CV as our benchmarking resampling method, a 5-fold CV is evaluated inside each auto tuned object to obtain the best hyperparameter combination. Note, that this method does not lead to an unbiased GE, but rather is a step to compare the learners to each other.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>lrns</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
  <span class='va'>rpart_learner</span>, <span class='va'>at_rpart</span>,
  <span class='va'>ranger_learner</span>, <span class='va'>at_ranger</span>,
  <span class='va'>kknn_learner</span>, <span class='va'>at_kknn</span>
<span class='op'>)</span>
<span class='va'>design</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3.mlr-org.com/reference/benchmark_grid.html'>benchmark_grid</a></span><span class='op'>(</span>
  tasks <span class='op'>=</span> <span class='va'>bike_task</span>,
  learners <span class='op'>=</span> <span class='va'>lrns</span>,
  resamplings <span class='op'>=</span> <span class='va'>resampling_outer_cv3</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123456</span><span class='op'>)</span>
<span class='va'>bmr</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3.mlr-org.com/reference/benchmark.html'>benchmark</a></span><span class='op'>(</span><span class='va'>design</span><span class='op'>)</span>
<span class='va'>bmr_table</span> <span class='op'>=</span> <span class='va'>bmr</span><span class='op'>$</span><span class='fu'>aggregate</span><span class='op'>(</span><span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>msr</a></span><span class='op'>(</span><span class='st'>"regr.rmse"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>nr</span>, <span class='va'>resample_result</span>, <span class='va'>task_id</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-38">Table 7: </span>Benchmarking results
</caption>
<thead>
<tr>
<th style="text-align:left;">
learner_id
</th>
<th style="text-align:left;">
resampling_id
</th>
<th style="text-align:right;">
iters
</th>
<th style="text-align:right;">
regr.rmse
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 8cm; ">
targettrafosimple.importance.regr.ranger.targetinverter.tuned
</td>
<td style="text-align:left;">
cv
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
44.09
</td>
</tr>
<tr>
<td style="text-align:left;width: 8cm; ">
regr.ranger
</td>
<td style="text-align:left;">
cv
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
61.96
</td>
</tr>
<tr>
<td style="text-align:left;width: 8cm; ">
targettrafosimple.regr.kknn.targetinverter.tuned
</td>
<td style="text-align:left;">
cv
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
76.42
</td>
</tr>
<tr>
<td style="text-align:left;width: 8cm; ">
regr.rpart
</td>
<td style="text-align:left;">
cv
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
89.73
</td>
</tr>
<tr>
<td style="text-align:left;width: 8cm; ">
targettrafosimple.regr.rpart.targetinverter.tuned
</td>
<td style="text-align:left;">
cv
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
102.25
</td>
</tr>
<tr>
<td style="text-align:left;width: 8cm; ">
regr.kknn
</td>
<td style="text-align:left;">
cv
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
120.60
</td>
</tr>
</tbody>
</table>
</div>
<p>Tuning enables us to optimize hyperparameters in our model via trial and error. For more details see <a href="https://mlr3book.mlr-org.com/optimization.html">mlr3tuning</a>.<br />
To evaluate each tuned learners’ performance and compare it, we set up benchmarking. Results are shown in Table 8 and Figure 14.<br />
In the boxplot resulting RMSE from the outer resampling are shown for each tuned learner from chapter 3.3 and its non-tuned equivalent. The benchmarking resampling validates our results from hyperparameter tuning for each autotuner in a 3-fold-cross-validation. We find that with auto tuning each of the learners could increase its performance compared to its’ equivalent that is using default hyperparameters. However, for <code>rpart</code> not only performance is increasing but also variance.<br />
That does not apply to the tuned <code>kknn</code> and <code>ranger</code> learners for which the results seem to be comparatively stable. With a RMSE of 0.31 the tuned random forest performs the best among tuned and untuned learners compared in benchmarking.<br />
Consequently, the tuned <code>ranger</code> is our learner of choice for prediction.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://rdrr.io/r/grDevices/png.html'>png</a></span><span class='op'>(</span><span class='st'>"bmr.png"</span><span class='op'>)</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/autoplot.html'>autoplot</a></span><span class='op'>(</span><span class='va'>bmr</span>, measure <span class='op'>=</span> <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>msr</a></span><span class='op'>(</span><span class='st'>"regr.rmse"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KNN"</span>, <span class='st'>"Random Forest"</span>, <span class='st'>"CART"</span>,
                              <span class='st'>"Random Forest Tuned"</span>  ,  <span class='st'>"KNN Tuned"</span>, <span class='st'>"CART Tuned"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='st'>"RMSE"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>9</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.off</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<figure>
<img src="bmr.png" alt="" /><figcaption>Autoplot benchmarking</figcaption>
</figure>
<h1 id="nested-resampling---autotune-a-graphlearner">Nested Resampling - Autotune a Graphlearner</h1>
<p>Benchmarking is a fast and simple way to compare different approaches to each other. However, from a theoretical perspective, this approach does not lead to unbiased general error estimators. Since we only used three different learners for benchmarking this bias should be insignificant. Nevertheless, we would like to provide a showcase for how to obtain unbiased results with more advanced techniques that are available in <code>mlr3</code>. Therefore we evaluate the performance of our learners by “true” unbiased nested resampling. In this case, tuning and model selection is only performed during inner resampling. The purpose of outer resampling is to evaluate the unbiased score from inner resampling. This method is also more exhaustive, as it tunes the graph learner in each of the three outer resampling CVs again. Benchmarking on the other hand, “only” tunes each autotuner once and cross-validates with the optimized hyperparameters from the first iteration.</p>
<h2 id="the-pipe">The Pipe</h2>
<p>We create a simple branched pipe, with our already known learners from the previous chapters. Note that we do not implement the autotuners but the actual learners here, since we aim to tune over the whole pipeline as a learner here, rather than over each learner individually. Therefore our selected learners <code>kknn</code>, <code>rpart</code> and <code>importance.ranger</code> can be considered as hyperparameters in a more universal graph-learner <code>glrn</code>. For more information see <a href="https://mlr3book.mlr-org.com/pipelines.html">mlr3pipelines</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>list</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://mlr3pipelines.mlr-org.com//reference/po.html'>po</a></span><span class='op'>(</span><span class='va'>kknn_learner</span><span class='op'>)</span>, <span class='fu'><a href='https://mlr3pipelines.mlr-org.com//reference/po.html'>po</a></span><span class='op'>(</span><span class='va'>rpart_learner</span><span class='op'>)</span>, <span class='fu'><a href='https://mlr3pipelines.mlr-org.com//reference/po.html'>po</a></span><span class='op'>(</span><span class='va'>ranger_learner</span><span class='op'>)</span><span class='op'>)</span>, <span class='va'>log1p_target_trafo</span><span class='op'>)</span>
<span class='va'>list</span><span class='op'>[[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3pipelines.mlr-org.com//reference/po.html'>po</a></span><span class='op'>(</span><span class='st'>"filter"</span>, <span class='va'>filter_ranger</span>, param_vals <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>filter.nfeat <span class='op'>=</span> <span class='fl'>11L</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;&gt;%</span>
  <span class='fu'><a href='https://mlr3pipelines.mlr-org.com//reference/po.html'>po</a></span><span class='op'>(</span><span class='st'>"learner"</span>, <span class='va'>list</span><span class='op'>[[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>]</span><span class='op'>$</span><span class='fu'>clone</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>pipe</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3pipelines.mlr-org.com//reference/ppl.html'>ppl</a></span><span class='op'>(</span><span class='st'>"branch"</span>, <span class='va'>list</span><span class='op'>)</span>
<span class='va'>pipe</span><span class='op'>$</span><span class='fu'>plot</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="the-parameter-set">The Parameter Set</h2>
<p>A few words should be said about this rather complex parameter set:</p>
<ul>
<li>We tune over the same hyperparameter spaces as in the autotuners before.</li>
<li>The only exception is the <code>importance.ranger</code>, for which we tune over <span class="math inline">\(\{6, 10, 11\}\)</span> features because the autotuners had the best performance at these values.</li>
<li>Logically, <code>k</code> or <code>distance</code> can only be called if the selected branch is <code>regr.kknn</code>. The same applies to the parameters of the other learners. For this purpose we add <em>dependencies</em> to the parameter.</li>
<li>In the <code>ParameterSet</code> <code>nfeat</code> is set to <code>levels</code>. This is used to control the levels, a grid can tune over. <code>mtry</code> is initialized in the transformation depending on the randomly chosen <code>nfeat</code>.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>ps</span> <span class='op'>=</span> <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamSet.html'>ParamSet</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
  <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamInt.html'>ParamInt</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='st'>"branch.selection"</span>, lower <span class='op'>=</span> <span class='fl'>1L</span>, upper <span class='op'>=</span> <span class='fl'>3L</span><span class='op'>)</span>,
  <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamInt.html'>ParamInt</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='st'>"targettrafosimple.regr.kknn.targetinverter.regr.kknn.k"</span>, lower <span class='op'>=</span> <span class='fl'>1L</span>, upper <span class='op'>=</span> <span class='fl'>50L</span><span class='op'>)</span>,
  <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamInt.html'>ParamInt</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='st'>"targettrafosimple.regr.kknn.targetinverter.regr.kknn.distance"</span>, lower <span class='op'>=</span> <span class='fl'>1L</span>, upper <span class='op'>=</span> <span class='fl'>3L</span><span class='op'>)</span>,
  <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamInt.html'>ParamInt</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='st'>"targettrafosimple.regr.rpart.targetinverter.regr.rpart.minsplit"</span>, lower <span class='op'>=</span> <span class='fl'>1L</span>, upper <span class='op'>=</span> <span class='fl'>30L</span><span class='op'>)</span>,
  <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamDbl.html'>ParamDbl</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='st'>"targettrafosimple.regr.rpart.targetinverter.regr.rpart.cp"</span>, lower <span class='op'>=</span> <span class='fl'>0.001</span>, upper <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span>,
  <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamFct.html'>ParamFct</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='st'>"importance.filter.nfeat"</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"6"</span>, <span class='st'>"9"</span>, <span class='st'>"11"</span><span class='op'>)</span><span class='op'>)</span>,
  <span class='va'><a href='https://paradox.mlr-org.com/reference/ParamInt.html'>ParamInt</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='st'>"importance.mtry"</span>, lower <span class='op'>=</span> <span class='fl'>7L</span>, upper <span class='op'>=</span> <span class='fl'>11L</span><span class='op'>)</span>
<span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1L</span><span class='op'>:</span><span class='fl'>3L</span>, each <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>, <span class='va'>ps</span><span class='op'>$</span><span class='fu'>ids</span><span class='op'>(</span><span class='op'>)</span><span class='op'>[</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>,
  MARGIN <span class='op'>=</span> <span class='fl'>1</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='va'>ps</span><span class='op'>$</span><span class='fu'>add_dep</span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"branch.selection"</span>, <span class='va'><a href='https://paradox.mlr-org.com/reference/Condition.html'>CondEqual</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='va'>ps</span><span class='op'>$</span><span class='va'>trafo</span> <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>param_set</span><span class='op'>)</span> <span class='op'>{</span>
 <span class='kw'>if</span> <span class='op'>(</span><span class='va'>x</span><span class='op'>$</span><span class='va'>branch.selection</span> <span class='op'>==</span> <span class='fl'>3L</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>x</span><span class='op'>$</span><span class='va'>importance.filter.nfeat</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>$</span><span class='va'>importance.filter.nfeat</span><span class='op'>)</span>
    <span class='va'>x</span><span class='op'>$</span><span class='va'>importance.mtry</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>$</span><span class='va'>importance.mtry</span><span class='op'>/</span><span class='fl'>11</span> <span class='op'>*</span> <span class='va'>x</span><span class='op'>$</span><span class='va'>importance.filter.nfeat</span><span class='op'>)</span>
 <span class='op'>}</span>
 <span class='va'>x</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<h2 id="resampling-the-autotuner">Resampling the Autotuner</h2>
<p>Now we can perform nested resampling using our previously created pipe. We directly resample this autotuner to reduce computing time. We can save the tuned learners in our resampling result by setting <code>store_model = TRUE</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>multi_at</span> <span class='op'>=</span> <span class='va'><a href='https://mlr3tuning.mlr-org.com/reference/AutoTuner.html'>AutoTuner</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span>
    learner <span class='op'>=</span> <span class='va'><a href='https://mlr3pipelines.mlr-org.com//reference/mlr_learners_graph.html'>GraphLearner</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='va'>pipe</span>, task_type <span class='op'>=</span> <span class='st'>"regr"</span><span class='op'>)</span>,
    resampling <span class='op'>=</span>  <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>rsmp</a></span><span class='op'>(</span><span class='st'>"cv"</span>, folds <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>,
    measure <span class='op'>=</span> <span class='va'>measures</span>,
    search_space <span class='op'>=</span> <span class='va'>ps</span>,
    term <span class='op'>=</span> <span class='fu'><a href='https://bbotk.mlr-org.com/reference/trm.html'>trm</a></span><span class='op'>(</span><span class='st'>"evals"</span>, n_evals <span class='op'>=</span> <span class='fl'>21</span><span class='op'>)</span>,
    tuner <span class='op'>=</span> <span class='fu'>mlr3tuning</span><span class='fu'>::</span><span class='fu'><a href='https://mlr3tuning.mlr-org.com/reference/tnr.html'>tnr</a></span><span class='op'>(</span><span class='st'>"random_search"</span><span class='op'>)</span>
    <span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>12345</span><span class='op'>)</span>
<span class='va'>multi_at_rr</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3.mlr-org.com/reference/resample.html'>resample</a></span><span class='op'>(</span><span class='va'>bike_task</span>, <span class='va'>multi_at</span>, <span class='va'>resampling_outer_cv3</span>, store_models <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'>#arrange archive</span>
<span class='va'>cols</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"regr.rmse"</span>, <span class='st'>"branch.selection"</span>,
          <span class='st'>"targettrafosimple.regr.kknn.targetinverter.regr.kknn.k"</span>,
          <span class='st'>"targettrafosimple.regr.kknn.targetinverter.regr.kknn.distance"</span>,
          <span class='st'>"targettrafosimple.regr.rpart.targetinverter.regr.rpart.minsplit"</span>,
          <span class='st'>"targettrafosimple.regr.rpart.targetinverter.regr.rpart.cp"</span>,
          <span class='st'>"importance.filter.nfeat"</span>, <span class='st'>"importance.mtry"</span><span class='op'>)</span>
<span class='va'>multi_at_archiv</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span>
 <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>,
 <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='va'>multi_at_rr</span><span class='op'>$</span><span class='va'>data</span><span class='op'>$</span><span class='va'>learner</span><span class='op'>[[</span><span class='va'>x</span><span class='op'>]</span><span class='op'>]</span><span class='op'>$</span><span class='va'>archive</span><span class='op'>$</span><span class='fu'>data</span><span class='op'>(</span><span class='op'>)</span><span class='op'>[</span>, <span class='va'>..cols</span><span class='op'>]</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-42">Table 8: </span>nested resampling outer-cv results
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
RMSE
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
learner-branch
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
k
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
distance
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
minsplit
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cp
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
nfeat
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mtry
</th>
</tr>
</thead>
<tbody>
<tr grouplength="21">
<td colspan="8" style="border-bottom: 1px solid;">
<strong>Outer CV-1</strong>
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
148.46285
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
0.0335980
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
78.19935
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
156.95734
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
0.0407070
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
148.46285
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0306334
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
131.29139
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
77.70967
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
70.69794
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
124.32739
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
204.37702
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0218316
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
72.40151
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
159.44030
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0916700
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
128.91845
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
159.44030
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
0.0641958
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
148.37438
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
159.44030
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.0745519
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
70.86133
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
72.21180
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
144.47091
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
159.44030
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
0.0759690
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
77.22525
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
72.41628
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr grouplength="21">
<td colspan="8" style="border-bottom: 1px solid;">
<strong>Outer CV-2</strong>
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
70.90703
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
128.60097
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
0.0111552
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
73.32828
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
155.05227
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
145.04972
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
133.32470
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
78.19142
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
126.72121
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
0.0076925
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
144.14502
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
174.11230
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
73.28386
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
144.89675
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
0.0239967
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
78.08017
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
73.09981
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
159.00586
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
0.0560581
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
78.12298
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
147.90780
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
155.53159
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
159.33757
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0810964
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
127.10846
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
159.33757
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0593319
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr grouplength="21">
<td colspan="8" style="border-bottom: 1px solid;">
<strong>Outer CV-3</strong>
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
148.38511
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
157.53131
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.0900243
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
76.41411
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
130.27486
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
69.57183
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
130.47776
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.0116256
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
157.53131
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
0.0761248
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
157.53131
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.0848399
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
146.32105
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
36
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
157.53131
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
0.0828409
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
141.57592
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
0.0202572
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
120.43218
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
135.86966
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
157.53131
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0706477
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
147.61153
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
157.53131
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.0708308
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
202.20482
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0132166
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
157.53131
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0715144
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
76.33956
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
157.11866
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0402888
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right; padding-left:  2em;" indentlevel="1">
157.53131
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
0.0963503
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The table shows the results on the first of three outer resampling results. Nested resampling carries out very similar results as Benchmarking in the previous chapter.</p>
<h1 id="prediction">Prediction</h1>
<p>Now we use our tuned random forest model to predict the Bike Sharing demand for the train and test data.</p>
<p>Before we can make the predictions, we have to preprocess the test data and engineer features in the same way we did for our training data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>test_datetime</span> <span class='op'>=</span> <span class='va'>test</span><span class='op'>$</span><span class='va'>datetime</span>
<span class='va'>test</span> <span class='op'>=</span> <span class='fu'>preprocess</span><span class='op'>(</span><span class='va'>test</span><span class='op'>)</span>
<span class='va'>test</span> <span class='op'>=</span> <span class='fu'>engineer_features</span><span class='op'>(</span><span class='va'>test</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now we can use our random forest <code>autotuner</code> to predict the <code>log1p_count</code> variable.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>pred_train</span> <span class='op'>=</span> <span class='va'>at_ranger</span><span class='op'>$</span><span class='fu'>predict</span><span class='op'>(</span><span class='va'>bike_task</span><span class='op'>)</span>
<span class='va'>pred_test</span> <span class='op'>=</span> <span class='va'>at_ranger</span><span class='op'>$</span><span class='fu'>predict_newdata</span><span class='op'>(</span><span class='va'>test</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>A visual comparison between the predicted demand with the actual demand is shown in Figure 15. The points depict the actual values and the green bars show our predicted values. The spaces with no points are the 19th day until the end of each month for which we only have test data. We find that overall the model predictions are quite close to the actual values and that the forecast seems reasonable for the test data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:unnamed-chunk-47"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-47-1.png" alt="Bike Sharing Demand: Forecast vs. Actual" width="624" />
<p class="caption">
Figure 14: Bike Sharing Demand: Forecast vs. Actual
</p>
</div>
</div>
<p>In Figure 16, we compare the predictions with the actual data grouped by the days of the month. Again, we find that the predictions are very close to the actual values. However, the model seems to systematically underestimate the actual values slightly.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:unnamed-chunk-48"></span>
<img src="2020-07-27-bikesharing-demand_files/figure-html5/unnamed-chunk-48-1.png" alt="Distribution of Bike Sharing demand over a month" width="624" />
<p class="caption">
Figure 15: Distribution of Bike Sharing demand over a month
</p>
</div>
</div>
<h1 id="conclusion">Conclusion</h1>
<p>The <code>mlr3verse</code> makes the process of model fitting, tuning, benchmarking and nested resampling intuitive and fast. The included packages provide access to a set of commonly used learners and their train and predict methods using R6 classes. Moreover one can increase the capabilities of learners of the original packages through tuning, benchmarking as well as imputing and even ensembling. <code>mlr3</code> provides these methods in a simple syntax to create understandable and comparable code architectures.<br />
Using these resources we set up a generalized tuning process for <code>kknn</code>, <code>rpart</code> and <code>ranger</code> learners. By tuning two hyperparameters of each learner, we were able to considerably increase performance of each learner. Performance comparison through nested resampling provided a solid foundation for choosing the best learner to predict the test set. With a rather simple random forest learner, we made it into the top 15% of Kaggle competition results. Further research can be carried out with regard to the apparent issue of systematic underestimation. A model with more affinity to the risk of a higher <code>count</code> could improve performance. To obtain such a model, one could, for example, try to increase the variability of the model by choosing a smaller <code>min.nodesize</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references" role="doc-bibliography">
<div id="ref-Fanaee">
<p>Fanaee-T, Hadi, and Joao Gama. 2013. “Event Labeling Combining Ensemble Detectors and Background Knowledge.” <em>Progress in Artificial Intelligence</em>, 1–15.</p>
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Funk, et al. (2020, July 27). mlr3gallery: Bike Sharing Demand - Use Case. Retrieved from https://mlr3gallery.mlr-org.com/posts/2020-07-27-bikesharing-demand/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{funk2020bike,
  author = {Funk, Henri and Hofheinz, Andreas and Girnat, Marius},
  title = {mlr3gallery: Bike Sharing Demand - Use Case},
  url = {https://mlr3gallery.mlr-org.com/posts/2020-07-27-bikesharing-demand/},
  year = {2020}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
