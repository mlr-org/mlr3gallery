<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
<title>mlr3gallery: A pipeline for the titanic data set - Advanced</title>

<meta property="description" itemprop="description" content="This post shows how to build a Graph using the mlr3pipelines package on the &quot;titanic&quot; dataset. Moreover, feature engineering, data imputation and benchmarking are covered."/>

<link rel="canonical" href="https://mlr3gallery.mlr-org.com/posts/2020-04-27-mlr3pipelines-Imputation-titanic/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2020-04-27"/>
<meta property="article:created" itemprop="dateCreated" content="2020-04-27"/>
<meta name="article:author" content="Florian Pfisterer"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="mlr3gallery: A pipeline for the titanic data set - Advanced"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="This post shows how to build a Graph using the mlr3pipelines package on the &quot;titanic&quot; dataset. Moreover, feature engineering, data imputation and benchmarking are covered."/>
<meta property="og:url" content="https://mlr3gallery.mlr-org.com/posts/2020-04-27-mlr3pipelines-Imputation-titanic/"/>
<meta property="og:image" content="https://mlr3gallery.mlr-org.com/posts/2020-04-27-mlr3pipelines-Imputation-titanic/2020-04-27-mlr3pipelines-titanic-advanced_files/figure-html5/unnamed-chunk-11-1.png"/>
<meta property="og:image:width" content="1248"/>
<meta property="og:image:height" content="768"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="mlr3gallery"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="mlr3gallery: A pipeline for the titanic data set - Advanced"/>
<meta property="twitter:description" content="This post shows how to build a Graph using the mlr3pipelines package on the &quot;titanic&quot; dataset. Moreover, feature engineering, data imputation and benchmarking are covered."/>
<meta property="twitter:url" content="https://mlr3gallery.mlr-org.com/posts/2020-04-27-mlr3pipelines-Imputation-titanic/"/>
<meta property="twitter:image" content="https://mlr3gallery.mlr-org.com/posts/2020-04-27-mlr3pipelines-Imputation-titanic/2020-04-27-mlr3pipelines-titanic-advanced_files/figure-html5/unnamed-chunk-11-1.png"/>
<meta property="twitter:image:width" content="1248"/>
<meta property="twitter:image:height" content="768"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="mlr3gallery: A pipeline for the titanic data set - Advanced"/>
<meta name="citation_fulltext_html_url" content="https://mlr3gallery.mlr-org.com/posts/2020-04-27-mlr3pipelines-Imputation-titanic/"/>
<meta name="citation_online_date" content="2020/04/27"/>
<meta name="citation_publication_date" content="2020/04/27"/>
<meta name="citation_author" content="Florian Pfisterer"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","categories","author","description","date","output","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["A pipeline for the titanic data set - Advanced"]},{"type":"character","attributes":{},"value":["imputation","classification","mlr3pipelines","feature engineering"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Florian Pfisterer"]}]}]},{"type":"character","attributes":{},"value":["This post shows how to build a Graph using the mlr3pipelines package on the \"titanic\" dataset. Moreover, feature engineering, data imputation and benchmarking are covered."]},{"type":"character","attributes":{},"value":["04-27-2020"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","css"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["../../custom.css"]}]}]},{"type":"character","attributes":{},"value":["https://mlr3gallery.mlr-org.com/posts/2020-04-27-mlr3pipelines-Imputation-titanic/"]},{"type":"character","attributes":{},"value":["https://mlr3gallery.mlr-org.com/posts/2020-04-27-mlr3pipelines-Imputation-titanic/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["2020-04-27-mlr3pipelines-titanic-advanced_files/figure-html5/unnamed-chunk-11-1.png","2020-04-27-mlr3pipelines-titanic-advanced_files/figure-html5/unnamed-chunk-17-1.png","2020-04-27-mlr3pipelines-titanic-advanced_files/figure-html5/unnamed-chunk-23-1.png","2020-04-27-mlr3pipelines-titanic-advanced_files/figure-html5/unnamed-chunk-24-1.png","2020-04-27-mlr3pipelines-titanic-advanced_files/figure-html5/unnamed-chunk-25-1.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #455a64;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative;}
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

</style>

<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for table of contents */

.d-toc {
  color: rgba(0,0,0,0.8);
  font-size: 0.8em;
  line-height: 1em;
}

.d-toc-header {
  font-size: 0.6rem;
  font-weight: 400;
  color: rgba(0, 0, 0, 0.5);
  text-transform: uppercase;
  margin-top: 0;
  margin-bottom: 1.3em;
}

.d-toc a {
  border-bottom: none;
}

.d-toc ul {
  padding-left: 0;
}

.d-toc li>ul {
  padding-top: 0.8em;
  padding-left: 16px;
  margin-bottom: 0.6em;
}

.d-toc ul,
.d-toc li {
  list-style-type: none;
}

.d-toc li {
  margin-bottom: 0.9em;
}

.d-toc-separator {
  margin-top: 20px;
  margin-bottom: 2em;
}

.d-article-with-toc {
  border-top: none;
  padding-top: 0;
}



/* Tweak code blocks (note that this CSS is repeated above in an injection
   into the d-code shadow dom) */

d-code {
  overflow-x: auto !important;
}

pre.d-code code.d-code {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

pre.text-output {

  font-size: 12px;
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

@media(min-width: 768px) {

d-code {
  overflow-x: visible !important;
}

pre.d-code code.d-code  {
    padding-left: 18px;
    font-size: 14px;
}
pre.text-output {
  font-size: 14px;
}
}

/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}



/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}


/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // create d-bibliography
  var bibliography = $('<d-bibliography></d-bibliography>');
  $('#distill-bibliography').wrap(bibliography);

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace citations with <d-cite>
  $('.citation').each(function(i, val) {
    appendix = true;
    var cites = $(this).attr('data-cites').split(" ");
    var dt_cite = $('<d-cite></d-cite>');
    dt_cite.attr('key', cites.join());
    $(this).replaceWith(dt_cite);
  });
  // remove refs
  $('#refs').remove();

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-toc a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // replace code blocks with d-code
  $('pre>code').each(function(i, val) {
    var code = $(this);
    var pre = code.parent();
    var clz = "";
    var language = pre.attr('class');
    if (language) {
      // map unknown languages to "clike" (without this they just dissapear)
      if ($.inArray(language, ["bash", "clike", "css", "go", "html",
                               "javascript", "js", "julia", "lua", "markdown",
                               "markup", "mathml", "python", "svg", "xml"]) == -1)
        language = "clike";
      language = ' language="' + language + '"';
      var dt_code = $('<d-code block' + language + clz + '></d-code>');
      dt_code.text(code.text());
      pre.replaceWith(dt_code);
    } else {
      code.addClass('text-output').unwrap().changeElementType('pre');
    }
  });

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('d-code, pre.text-output, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // table of contents
    if (have_authors) // adjust border if we are in authors
      $('.d-toc').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // inject pre code styles (can't do this with a global stylesheet b/c a shadow root is used)
    $('d-code').each(function(i, val) {
      var style = document.createElement('style');
      style.innerHTML = 'pre code { padding-left: 10px; font-size: 12px; border-left: 2px solid rgba(0,0,0,0.1); } ' +
                        '@media(min-width: 768px) { pre code { padding-left: 18px; font-size: 14px; } }';
      if (this.shadowRoot)
        this.shadowRoot.appendChild(style);
    });

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-toc-header').remove();
  $('.d-toc').remove();
  $('.d-toc-separator').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="../../custom.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"A pipeline for the titanic data set - Advanced","description":"This post shows how to build a Graph using the mlr3pipelines package on the \"titanic\" dataset. Moreover, feature engineering, data imputation and benchmarking are covered.","authors":[{"author":"Florian Pfisterer","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#"}],"publishedDate":"2020-04-27T00:00:00.000+00:00","citationText":"Pfisterer, 2020"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="https://mlr3.mlr-org.com">
<img src="../../images/logo.png"/>
</a>
<a href="../../index.html" class="title">mlr3gallery</a>
</div>
<div class="nav-right">
<a href="https://github.com/mlr-org/mlr3gallery">
<i class="fab fa-github"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>A pipeline for the titanic data set - Advanced</h1>
<p><p>This post shows how to build a Graph using the mlr3pipelines package on the “titanic” dataset. Moreover, feature engineering, data imputation and benchmarking are covered.</p></p>
</div>

<div class="d-byline">
  Florian Pfisterer  
  
<br/>04-27-2020
</div>

<div class="d-article">
<p>This is the second post of the titanic use case series. You can find the first use case <a href="/2020-03-12-intro-pipelines-titanic/">here</a>. <!-- Need to fix hyperlink --> In this section we will focus on more advanced usage of <code>mlr3pipelines</code>. Specifically, this section illustrates the different options when it comes to data imputation and feature engineering. Furthermore, the section shows how to <strong>benchmark</strong>, <strong>feature engineer</strong> and compare our results. Again, we need to take some prepatory steps:</p>
<p>For the case that you are only tuning in for the second part, we need to load some packages: The data is part of the <code>mlr3data</code> package.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(&quot;mlr3&quot;)
library(&quot;mlr3learners&quot;)
library(&quot;mlr3pipelines&quot;)
library(&quot;mlr3data&quot;)
library(&quot;mlr3misc&quot;)
library(&quot;ggplot2&quot;)
library(&quot;mlr3viz&quot;)
data(&quot;titanic&quot;)</code></pre>
</div>
<p>As in the basics chapter, we use the titanic data set. To recap we have undertaken the following steps:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# splitting the data set
titanic_train &lt;- titanic[1:891, ]
titanic_test &lt;- titanic[892:1309, ]

# setting up the task 
task &lt;- TaskClassif$new(&quot;titanic&quot;, titanic_train, target = &quot;survived&quot;, positive = &quot;1&quot;)
task$select(cols = setdiff(task$feature_names, c(&quot;cabin&quot;, &quot;name&quot;, &quot;ticket&quot;)))

# setting up the learner
learner &lt;- lrn(&quot;classif.rpart&quot;)

#setting up our resampling method
rdesc &lt;- rsmp(&quot;cv&quot;, folds = 3L)$instantiate(task)
res &lt;- resample(task, learner, rdesc, store_models = TRUE)</code></pre>
</div>
<h2 id="imputation">Imputation</h2>
<p>A very simple way to do this to just impute a constant value for each feature. We could i.e. impute every <code>character</code> or <code>factor</code> column with <code>missing</code> and every numeric column with <code>-999</code>. And depending on the model, this might actually be fine. This approach has a few drawbacks though:</p>
<ul>
<li><code>-999</code> could be a real value in the data.</li>
<li>imputing <code>-999</code> skews the distribution of the data, which might result in bad models.</li>
</ul>
<p>As a result, instead of imputing a constant value, we will do two things: * Draw samples from each numeric features’ histogram using <code>PipeOpImputeHist</code> * Add an additional column for each <code>variable</code> that indicates whether a value was missing or not. If the information that a value was missing is important, this column contains this information.</p>
<p>This imputation scheme is called ‘imputation with constants’ and is already implemented in <code>mlr3pipelines</code>. It can be done using <code>PipeOpImputeConstant</code>.</p>
<p>Remember that we are trying to optimize our predictive power by using a random forest model (‘classif.ranger’). Now, random forest models do not naturally handle missing values which is the reason why we need imputation. Before imputation, our data looks as follows:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
task$missings()</code></pre>
<pre><code>
survived      age embarked     fare    parch   pclass      sex   sib_sp 
       0      177        2        0        0        0        0        0 </code></pre>
</div>
<p>Let’s first deal with the categorical variables:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
po_newlvl &lt;- po(&quot;imputenewlvl&quot;)
task_newlvl &lt;- po_newlvl$train(list(task))[[1]]</code></pre>
</div>
<p>Note that we use the <code>PipeOp</code> in an unusual way, which is why the syntax does not look very clean. We’ll learn how to use a full graph below.</p>
<p>First, let’s look at the result:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
task_newlvl$missings()</code></pre>
<pre><code>
survived      age     fare    parch   pclass      sex   sib_sp embarked 
       0      177        0        0        0        0        0        0 </code></pre>
</div>
<p>Cool! <code>embarked</code> does not have missing values anymore. Note that <code>PipeOpImputeNewLvl</code> by default affects <code>character</code>, <code>factor</code> and <code>ordered</code> columns.</p>
<p>For the <code>numeric</code> features we want to do two things, impute values and add an indicator column. In order to do this, we need a more complicated structure, a <code>Graph</code>.</p>
<p>Our <code>po_indicator</code> creates the indicator column. We tell it to only do this for <code>numeric</code> and <code>integer</code> columns via its <code>param_vals</code>, and additionally tell it to create a numeric column (0 = “not missing”, 1 = “missing”).</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
po_indicator &lt;- po(&quot;missind&quot;,
  param_vals = list(affect_columns = selector_type(c(&quot;numeric&quot;, &quot;integer&quot;)), type = &quot;numeric&quot;)
)</code></pre>
</div>
<p>Now we can simultaneously impute features from the histogram and create indicator columns. This can be achieved using the <code>gunion</code> function, which puts two operations in parallel:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
gr &lt;- gunion(list(po_indicator, po(&quot;imputehist&quot;)))
gr &lt;- gr %&gt;&gt;% po(&quot;featureunion&quot;)</code></pre>
</div>
<p>Afterwards, we <code>cbind</code> the resulting data using <code>po("featureunion")</code>, connecting the different operations using our <strong>graph connector</strong>: <code>%&gt;&gt;%</code>. We can now also connect the newlvl imputation:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
gr &lt;- gr %&gt;&gt;% po(&quot;imputenewlvl&quot;)</code></pre>
</div>
<p>and see what happens when we now train the whole <strong>Graph</strong>:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
task_imputed &lt;- gr$clone()$train(task)[[1]]
task_imputed$missings()</code></pre>
<pre><code>
   survived missing_age      pclass         sex        fare       parch 
          0           0           0           0           0           0 
     sib_sp         age    embarked 
          0           0           0 </code></pre>
</div>
<p>Awesome, now we do not have any missing values!</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
autoplot(task_imputed)</code></pre>
<p><img src="2020-04-27-mlr3pipelines-titanic-advanced_files/figure-html5/unnamed-chunk-11-1.png" width="624" /></p>
</div>
<p>We could now use <code>task_imputed</code> for resampling and see whether a <strong>ranger</strong> model does better. But this is dangerous! If we preprocess all training data at once, data could leak through the different cross-validation folds. In order to do this properly, we have to process the training data in every fold separately. Luckily, this is automatically handled in our <code>Graph</code>, if we use it through a <code>GraphLearner</code>.</p>
<p>We can simple append a <code>ranger</code> learner to the Graph and create a <code>GraphLearner</code> from this.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
glrn &lt;- GraphLearner$new(gr$clone() %&gt;&gt;% 
  po(&quot;imputesample&quot;) %&gt;&gt;%
  po(&quot;fixfactors&quot;) %&gt;&gt;%
  po(learner))</code></pre>
</div>
<p>We needed to use the following commands for the Graph: * <code>fixfactors</code>: Removes empty factor levels and removes factor levels that do not exist during training. * <code>imputesample</code>: In some cases, if missing factor levels do not occur during training but only while predicting, <code>imputenewlvl</code> does not create a new level. For those, we sample a random value.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
res &lt;- resample(task, glrn, rdesc, store_models = TRUE)
agg &lt;- res$aggregate(msr(&quot;classif.acc&quot;))
agg</code></pre>
<pre><code>
classif.acc 
  0.7923681 </code></pre>
</div>
<p>So our model has not improved heavily, currently it has an accuracy of 0.792.</p>
<h2 id="feature-engineering">Feature Engineering</h2>
<p>We will do this using <code>PipeOpMutate</code> in order to showcase the power of <code>mlr3pipelines</code>. Additionally, we will make use of the <code>character</code> columns. Hence, we will re-select them:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
task$col_roles$feature &lt;- c(task$feature_names, c(&quot;cabin&quot;, &quot;name&quot;, &quot;ticket&quot;))</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(&quot;stringi&quot;)
po_ftextract &lt;- po(&quot;mutate&quot;, param_vals = list(
  mutation = list(
    fare_per_person = ~ fare / (parch + sib_sp + 1),
    deck = ~ factor(stri_sub(cabin, 1, 1)),
    title = ~ factor(stri_match(name, regex = &quot;, (.*)\\.&quot;)[, 2]),
    surname = ~ factor(stri_match(name, regex = &quot;(.*),&quot;)[, 2]),
    ticket_prefix = ~ factor(stri_replace_all_fixed(stri_trim(stri_match(ticket, regex = &quot;(.*) &quot;)[, 2]), &quot;.&quot;, &quot;&quot;))
  )
))</code></pre>
</div>
<p>Quickly checking what happens:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
task_eng &lt;- po_ftextract$clone()$train(list(task))[[1]]
task_eng$data()</code></pre>
<pre><code>
     survived age embarked    fare parch pclass    sex sib_sp cabin
  1:        0  22        S  7.2500     0      3   male      1  &lt;NA&gt;
  2:        1  38        C 71.2833     0      1 female      1   C85
  3:        1  26        S  7.9250     0      3 female      0  &lt;NA&gt;
  4:        1  35        S 53.1000     0      1 female      1  C123
  5:        0  35        S  8.0500     0      3   male      0  &lt;NA&gt;
 ---                                                               
887:        0  27        S 13.0000     0      2   male      0  &lt;NA&gt;
888:        1  19        S 30.0000     0      1 female      0   B42
889:        0  NA        S 23.4500     2      3 female      1  &lt;NA&gt;
890:        1  26        C 30.0000     0      1   male      0  C148
891:        0  32        Q  7.7500     0      3   male      0  &lt;NA&gt;
                                                    name           ticket
  1:                             Braund, Mr. Owen Harris        A/5 21171
  2: Cumings, Mrs. John Bradley (Florence Briggs Thayer)         PC 17599
  3:                              Heikkinen, Miss. Laina STON/O2. 3101282
  4:        Futrelle, Mrs. Jacques Heath (Lily May Peel)           113803
  5:                            Allen, Mr. William Henry           373450
 ---                                                                     
887:                               Montvila, Rev. Juozas           211536
888:                        Graham, Miss. Margaret Edith           112053
889:            Johnston, Miss. Catherine Helen &quot;Carrie&quot;       W./C. 6607
890:                               Behr, Mr. Karl Howell           111369
891:                                 Dooley, Mr. Patrick           370376
     fare_per_person deck title   surname ticket_prefix
  1:         3.62500 &lt;NA&gt;    Mr    Braund           A/5
  2:        35.64165    C   Mrs   Cumings            PC
  3:         7.92500 &lt;NA&gt;  Miss Heikkinen       STON/O2
  4:        26.55000    C   Mrs  Futrelle          &lt;NA&gt;
  5:         8.05000 &lt;NA&gt;    Mr     Allen          &lt;NA&gt;
 ---                                                   
887:        13.00000 &lt;NA&gt;   Rev  Montvila          &lt;NA&gt;
888:        30.00000    B  Miss    Graham          &lt;NA&gt;
889:         5.86250 &lt;NA&gt;  Miss  Johnston           W/C
890:        30.00000    C    Mr      Behr          &lt;NA&gt;
891:         7.75000 &lt;NA&gt;    Mr    Dooley          &lt;NA&gt;</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
autoplot(task_eng$clone()$select(c(&quot;sex&quot;, &quot;age&quot;)), type = &quot;pairs&quot;)</code></pre>
<p><img src="2020-04-27-mlr3pipelines-titanic-advanced_files/figure-html5/unnamed-chunk-17-1.png" width="624" /></p>
</div>
<p>Now we can put everything together again, we concatenate our new <code>PipeOp</code> with the <code>Graph</code> created above and use <code>PipeOpSelect</code> in order to de-select the <code>character</code> features we used for feature extraction. Additionally, we collapse the ‘surname’, so only surnames that make up more than 0.6 % of the data are kept.</p>
<p>In summary we do the following:</p>
<ul>
<li><code>mutate</code>: The <code>po_ftextract</code> we defined above extracts additional features from the data.</li>
<li><code>collapsefactors</code>: Removes factor levels that make up less then 3 % of the data.</li>
<li><code>select</code>: Drops <code>character</code> columns.</li>
<li><code>gunion</code>: Puts two <code>PipeOp</code>s in parallel.
<ul>
<li><code>missind</code>: <code>po_indicator</code> adds a column for each numeric with the info whether the value is NA or not.</li>
<li><code>imputehist</code>: Imputes numeric and integer columns by sampling from the histogram.</li>
</ul></li>
<li><code>featureunion</code>: Cbind’s parallel data streams.</li>
<li><code>imputenewlvl</code>: Imputes factor and ordered columns.</li>
<li><code>fixfactors</code>: Removes empty factor levels and removes factor levels that do not exist during training.</li>
<li><code>imputesample</code>: In some cases, if missing factor levels do not occur during training but only while predicting, <code>imputenewlvl</code> does not create a new level. For those, we sample a random value.</li>
<li><code>learner</code>: Appends a learner to the <code>Graph</code>.</li>
</ul>
<p>The full graph we created is the following:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
learner &lt;- lrn(&quot;classif.ranger&quot;)
learner$param_set$values &lt;- list(num.trees = 500, min.node.size = 4)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
gr_final &lt;- po_ftextract %&gt;&gt;%
  po(&quot;collapsefactors&quot;, param_vals = list(no_collapse_above_prevalence = 0.03)) %&gt;&gt;%
  po(&quot;select&quot;, param_vals = list(selector = selector_invert(selector_type(&quot;character&quot;)))) %&gt;&gt;%
  gunion(list(po_indicator, po(&quot;imputehist&quot;))) %&gt;&gt;%
  po(&quot;featureunion&quot;) %&gt;&gt;%
  po(&quot;imputenewlvl&quot;) %&gt;&gt;%
  po(&quot;fixfactors&quot;) %&gt;&gt;%
  po(&quot;imputesample&quot;) %&gt;&gt;%
  po(learner)</code></pre>
</div>
<h2 id="evaluation">Evaluation</h2>
<p>Let us see if things have improved:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
glrn &lt;- GraphLearner$new(gr_final)
res &lt;- resample(task, glrn, rdesc, store_models = TRUE)
agg_ranger &lt;- res$aggregate(msr(&quot;classif.acc&quot;))
agg_ranger</code></pre>
<pre><code>
classif.acc 
  0.8249158 </code></pre>
</div>
<p>We have improved even more!</p>
<h2 id="benchmarking">Benchmarking</h2>
<p>To undertake benchmarking, we need to set up a benchmarking design. The first step is creating a list with the learners we used, namely the learners form the first and second part of this use case.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
lrn_list &lt;- list(
  lrn(&quot;classif.rpart&quot;, predict_type = &quot;prob&quot;),
  lrn(&quot;classif.ranger&quot;, predict_type = &quot;prob&quot;)
)</code></pre>
</div>
<p>After having done that, we can set up our benchmark grid: ?lrn Now we can define our benchmark design. This is done to ensure exhaustive and consistent resampling for all learners. This step is needed to execute over the same train/test split for each task.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
bm_design &lt;- benchmark_grid(task = task_imputed, resamplings = rsmp(&quot;cv&quot;, folds = 10), learners = lrn_list)
bmr &lt;- benchmark(bm_design, store_models = TRUE)
print(bmr)</code></pre>
<pre><code>
&lt;BenchmarkResult&gt; of 20 rows with 2 resampling runs
 nr task_id     learner_id resampling_id iters warnings errors
  1 titanic  classif.rpart            cv    10        0      0
  2 titanic classif.ranger            cv    10        0      0</code></pre>
</div>
<p>So, where do we go from here? We could for instance use a boxplot:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
autoplot(bmr) + theme(axis.text.x = element_text(angle = 45, hjust = 1))</code></pre>
<p><img src="2020-04-27-mlr3pipelines-titanic-advanced_files/figure-html5/unnamed-chunk-23-1.png" width="624" /></p>
</div>
<p>Further we are able to compare sensitivity and specificity. Here we need to ensure that the benchmark results only contain a single Task:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
autoplot(bmr$clone()$filter(task_id = &quot;titanic&quot;), type = &quot;roc&quot;)</code></pre>
<p><img src="2020-04-27-mlr3pipelines-titanic-advanced_files/figure-html5/unnamed-chunk-24-1.png" width="624" /></p>
</div>
<p>Moreover, one can compare the the precision-recall:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# Precision vs Recall
ggplot2::autoplot(bmr, type = &quot;prc&quot;)</code></pre>
<p><img src="2020-04-27-mlr3pipelines-titanic-advanced_files/figure-html5/unnamed-chunk-25-1.png" width="624" /></p>
</div>
<p>As one can see, there are various options when it comes to benchmarking and visualizing. You could have a look at some other use cases in our gallery for inspiration.</p>
<h2 id="future">Future</h2>
<p>In this case we have examined a number of different features, but there are many more things to explore! We could extract even more information from the different features and see what happens. But now you are left to yourself! There are many <a href="https://www.kaggle.com/c/titanic">kaggle kernels</a> that treat the <strong>Titanic Dataset</strong> available. This can be a great starter to find even better models.</p>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Pfisterer (2020, April 27). mlr3gallery: A pipeline for the titanic data set - Advanced. Retrieved from https://mlr3gallery.mlr-org.com/posts/2020-04-27-mlr3pipelines-Imputation-titanic/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{pfisterer2020a,
  author = {Pfisterer, Florian},
  title = {mlr3gallery: A pipeline for the titanic data set - Advanced},
  url = {https://mlr3gallery.mlr-org.com/posts/2020-04-27-mlr3pipelines-Imputation-titanic/},
  year = {2020}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
